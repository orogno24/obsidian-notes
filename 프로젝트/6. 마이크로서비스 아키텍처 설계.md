### 1. **서비스별 구조**

```
auth-service/
├── src/main/
│   ├── java/           # Spring Boot 백엔드
│   ├── resources/
│   │   ├── static/     # CSS, JS, 이미지
│   │   ├── templates/  # Thymeleaf HTML
│   │   │   ├── login.html
│   │   │   ├── register.html
│   │   │   └── fragments/
│   │   │       └── auth-navbar.html
│   │   └── application.yml

recipe-service/
├── src/main/
│   ├── java/
│   ├── resources/
│   │   ├── static/
│   │   ├── templates/
│   │   │   ├── recipe-search.html
│   │   │   ├── recipe-detail.html
│   │   │   └── fragments/
│   │   │       └── recipe-navbar.html
│   │   └── application.yml

nutrition-service/
├── src/main/
│   ├── java/
│   ├── resources/
│   │   ├── static/
│   │   ├── templates/
│   │   │   ├── nutrition-search.html
│   │   │   ├── nutrition-detail.html (우리가 만든 것)
│   │   │   └── fragments/
│   │   │       └── nutrition-navbar.html
│   │   └── application.yml
```

### 2. **Kong 라우팅 설정**

```yaml
Routes:
  # Auth Service (UI + API)
  - /auth/*           → auth-service:8081
  - /login            → auth-service:8081
  - /register         → auth-service:8081
  - /api/auth/*       → auth-service:8081

  # Recipe Service (UI + API)
  - /recipes/*        → recipe-service:8082
  - /recipe-search    → recipe-service:8082
  - /recipe-detail/*  → recipe-service:8082
  - /api/recipes/*    → recipe-service:8082

  # Nutrition Service (UI + API)
  - /nutrition/*      → nutrition-service:8083
  - /nutrition-search → nutrition-service:8083
  - /nutrition-detail/* → nutrition-service:8083
  - /api/nutrition/*  → nutrition-service:8083

  # 홈페이지는 별도 처리 필요
  - /                 → auth-service:8081/home
```

### 3. **공통 리소스 처리 방안**

#### 옵션 1: 각 서비스에 복사

```yaml
# 각 서비스의 static 폴더에 동일한 파일 복사
- bootstrap.min.css
- style.css
- common.js
```

#### 옵션 2: CDN 사용 (권장)

```html
<!-- 공통 리소스는 CDN으로 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

<!-- 서비스별 커스텀 CSS -->
<link href="/css/nutrition-custom.css" rel="stylesheet">
```

### 4. **네비게이션 바 처리**

```html
<!-- 각 서비스의 navbar fragment -->
<nav th:fragment="navbar" class="navbar navbar-expand-xl">
    <a href="/" class="navbar-brand">EasyCook</a>
    <div class="navbar-nav">
        <!-- Kong을 통한 서비스 간 이동 -->
        <a href="/auth/home" class="nav-link">홈</a>
        <a href="/recipes/search" class="nav-link">레시피 검색</a>
        <a href="/nutrition/search" class="nav-link">영양정보</a>
        <a href="/auth/mypage" class="nav-link">마이페이지</a>
    </div>
</nav>
```

### 5. **서비스 간 인증 공유**

```java
// 각 서비스의 WebSecurityConfig
@Configuration
public class WebSecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) {
        http
            .authorizeRequests()
                .antMatchers("/", "/search", "/detail/**").permitAll()
                .antMatchers("/api/public/**").permitAll()
                .anyRequest().authenticated()
            .and()
            .oauth2ResourceServer()
                .jwt()
                .jwtAuthenticationConverter(jwtAuthenticationConverter());
                
        return http.build();
    }
}
```

### 6. **Spring Boot 설정**

```yaml
# application.yml (각 서비스)
server:
  port: 8081  # 서비스별로 다르게

spring:
  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html
    cache: false
    
  mvc:
    static-path-pattern: /static/**
    
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://auth-service:8081/auth
          
# Kong 통신을 위한 설정
app:
  services:
    auth-url: http://auth-service:8081
    recipe-url: http://recipe-service:8082
    nutrition-url: http://nutrition-service:8083
```

### 7. **Kubernetes 배포**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nutrition-service
spec:
  replicas: 2
  template:
    spec:
      containers:
      - name: nutrition-service
        image: easycook/nutrition-service:latest
        ports:
        - containerPort: 8083
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "k8s"
---
apiVersion: v1
kind: Service
metadata:
  name: nutrition-service
spec:
  selector:
    app: nutrition-service
  ports:
  - port: 8083
    targetPort: 8083
```

### 8. **장단점 분석**

#### 장점:

- 각 팀이 독립적으로 UI 개발 가능
- 배포가 간단함
- 서비스별 UI 커스터마이징 용이

#### 단점:

- 공통 리소스 중복
- UI 일관성 유지 어려움
- 번들 크기 증가

### 9. **개선 방안**

```yaml
Shared Library 방식:
  - 공통 컴포넌트를 Maven/Gradle 라이브러리로 관리
  - 각 서비스에서 dependency로 추가
  
Template Inheritance:
  - Thymeleaf Layout Dialect 사용
  - 기본 레이아웃 템플릿 공유
  
Build Time Optimization:
  - 공통 리소스는 Kong 레벨에서 캐싱
  - 서비스별 리소스만 각 서비스에서 제공
```

이 방식으로 구현하면 각 서비스가 자체 UI를 가지면서도 마이크로서비스 아키텍처의 장점을 유지할 수 있습니다. 특히 작은 팀이나 초기 단계 프로젝트에 적합합니다.


```
apiVersion: v1
kind: ConfigMap
metadata:
  name: easycook-config
  namespace: easycook
data:
  # Spring Profiles
  SPRING_PROFILES_ACTIVE: "prod"
  
  # JWT Settings
  JWT_SECRET: "your-production-256-bit-secret-key-for-jwt-token-generation-please-change-this-in-production"
  JWT_EXPIRATION: "86400000"
  
  # CORS Settings
  CORS_ALLOWED_ORIGINS: "http://frontend-service.easycook.svc.cluster.local:8080,https://your-domain.com"
  CORS_ALLOWED_METHODS: "GET,POST,PUT,DELETE,OPTIONS"
  CORS_ALLOWED_HEADERS: "*"
  
  # Service URLs (내부 서비스 통신용)
  USER_SERVICE_URL: "http://user-service.easycook.svc.cluster.local:8082"
  RECIPE_SERVICE_URL: "http://recipe-service.easycook.svc.cluster.local:8084"
  NUTRITION_SERVICE_URL: "http://nutrition-service.easycook.svc.cluster.local:8086"
  FRONTEND_SERVICE_URL: "http://frontend-service.easycook.svc.cluster.local:8080"
  
  # Frontend 설정 (북마크 URL 생성용)
  APP_BASE_URL: "https://your-domain.com"  # 실제 도메인으로 변경 필요
  
  # Database Settings
  DB_URL: "jdbc:postgresql://postgres-service.easycook.svc.cluster.local:5432/easycook"
  DB_USERNAME: "easycook"
  
  # JPA Settings
  JPA_DDL_AUTO: "update"
  
  # External API URLs
  EXTERNAL_RECIPE_API_URL: "http://openapi.foodsafetykorea.go.kr/api"
  EXTERNAL_NUTRITION_API_URL: "http://openapi.foodsafetykorea.go.kr/api"
  
---
apiVersion: v1
kind: Secret
metadata:
  name: easycook-secrets
  namespace: easycook
type: Opaque
stringData:
  # Database Password
  DB_PASSWORD: "your-database-password"
  
  # External API Keys
  EXTERNAL_RECIPE_API_KEY: "your-recipe-api-key"
  EXTERNAL_NUTRITION_API_KEY: "your-nutrition-api-key"
```


# EasyCook 서비스 라우팅 설계

## 🗺️ 서비스 매핑

| 서비스                  | 포트   | 경로                 | 도메인                       |
| -------------------- | ---- | ------------------ | ------------------------- |
| **FrontendService**  | 8080 | `/`                | `easycook.dev.eris.go.kr` |
| **UserService**      | 8082 | `/api/user/*`      | `easycook.dev.eris.go.kr` |
| **RecipeService**    | 8084 | `/api/recipe/*`    | `easycook.dev.eris.go.kr` |
| **NutritionService** | 8086 | `/api/nutrition/*` | `easycook.dev.eris.go.kr` |

## 🔄 트래픽 플로우

```
사용자 요청
    ↓
NGINX Ingress Controller
    ↓
Kong Gateway (Optional)
    ↓
EasyCook 마이크로서비스들
```

## 📋 라우팅 규칙

1. **웹 UI**: `https://easycook.dev.eris.go.kr/` → FrontendService
2. **사용자 API**: `https://easycook.dev.eris.go.kr/api/user/` → UserService
3. **레시피 API**: `https://easycook.dev.eris.go.kr/api/recipe/` → RecipeService
4. **영양정보 API**: `https://easycook.dev.eris.go.kr/api/nutrition/` → NutritionService