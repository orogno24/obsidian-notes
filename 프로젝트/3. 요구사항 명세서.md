## Fruitables — 요구사항 명세서 (v1.0 · 2025-05-28)

> **목적** 이 문서는 _Fruitables_ 시스템이 반드시 충족해야 하는 기능·비기능 요구사항을 정의한다.  
> **범위** FruitCatalog, OrderManager, DeliveryMock 3개 마이크로서비스와 그 외 공통 인프라(Kong GW, RabbitMQ, PostgreSQL 등).

---

### 1. 용어‧약어

|용어|정의|
|---|---|
|**상품**|과일 1종(이름·가격·재고)|
|**주문**|사용자 1회 구매 행위|
|**배송 단계**|`READY → ON_ROUTE → DELIVERED`|
|**paymentToken**|모의 결제 토큰(형식: `tok_test_*`)|

---

### 2. 이해관계자 & 액터

|액터|설명|
|---|---|
|**사용자(Consumer)**|웹 UI로 상품 조회·주문|
|**시스템(Internal)**|서비스 간 재고 차감·배송 전이 동작|
|**관리자(Admin)**|초기 Seed 데이터 입력·재고 조정만 수행|

---

### 3. 기능 요구사항 (FR)

| ID        | 서비스      | 제목        | 상세 설명                                                                             | 우선순위 |
| --------- | -------- | --------- | --------------------------------------------------------------------------------- | ---- |
| **FR-01** | Catalog  | 상품 목록 조회  | `GET /fruits` 호출 시 전체 과일(이름·가격·재고) 반환                                             | ★★★  |
| **FR-02** | Catalog  | 상품 상세 조회  | `GET /fruits/{id}` → 존재하면 200, 없으면 404                                            | ★★★  |
| **FR-03** | Catalog  | 재고 차감     | 주문 성공 시 `PATCH /fruits/{id}/stock` 으로 재고 –quantity                                | ★★★  |
| **FR-04** | Order    | 주문 생성     | `POST /orders`(fruitId, quantity, paymentToken)‣ 재고 확인, token 검증, 주문 저장, 재고 차감 호출 | ★★★  |
| **FR-05** | Order    | 주문 목록     | `GET /orders` → 로그인 사용자의 주문 리스트 반환                                                | ★★   |
| **FR-06** | Order    | 주문 상세     | `GET /orders/{id}` → 상품, 수량, 금액, 배송 status                                        | ★★★  |
| **FR-07** | Delivery | 배송 시작     | `POST /delivery/start`(orderId) → 상태 READY 등록                                     | ★★   |
| **FR-08** | Delivery | 배송 상태 조회  | `GET /delivery/{orderId}` → 현재 단계 문자열 반환                                          | ★★★  |
| **FR-09** | Delivery | 상태 전이(수동) | `POST /delivery/advance`(orderId) → 다음 단계로 1단계 전진                                 | ★    |
| **FR-10** | 공통       | API 문서    | 각 서비스 OpenAPI 3.1 YAML 제공, Swagger-UI로 렌더                                         | ★★★  |

---

### 4. 비기능 요구사항 (NFR)

| ID         | 카테고리 | 요구사항                                  | 검증 방법                 |
| ---------- | ---- | ------------------------------------- | --------------------- |
| **NFR-01** | 성능   | 평균 API 응답 300 ms 이하(P95 800 ms)       | JMeter 부하테스트          |
| **NFR-02** | 신뢰성  | 주문·배송 단계 데이터 손실 0 건                   | k6 chaos 테스트 후 로그 확인  |
| **NFR-03** | 보안   | 서비스 간 통신 Istio mTLS 100 % 적용          | Kiali TLS 댄스그램        |
| **NFR-04** | 가용성  | 클러스터 가용률 99 %+ (단일 VM이지만 재시작 자동)      | UptimeRobot           |
| **NFR-05** | 추적성  | 주문 → 배송 호출이 Jaeger 트레이스에서 90 % 이상 확인  | Jaeger UI 샘플 20건 검토   |
| **NFR-06** | 배포   | `main` 브랜치 머지 후 10 분 이내 자동 배포 성공      | Jenkins·Argo CD 로그    |
| **NFR-07** | 문서화  | OpenAPI YAML 100 % lint 통과 & ReDoc 렌더 | openapi-lint, 브라우저 확인 |

---

### 5. 시스템 인터페이스 요약

|인터페이스|방식|소비자 → 제공자|설명|
|---|---|---|---|
|**API Gateway**|REST/JSON|Browser ↔ Kong|외부 → 내부 서비스 라우팅|
|**Stock Update**|REST (Internal)|Order → Catalog|주문 성공 시 재고 차감|
|**Delivery Trigger**|REST or RabbitMQ 이벤트|Order → Delivery|배송 시작 통보|
|**Metrics**|Prometheus Scrape|각 Pod → Prometheus|`/metrics` 엔드포인트 노출|

---

### 6. 제약 & 가정

1. 인증은 **JWT (모의 서명)** 방식으로 사용자 식별만 수행한다.
2. 결제는 **실 PG 미연동**; paymentToken 패턴 검증으로 대체한다.
3. 클러스터는 GCP VM 1 노드이므로 고가용성은 아닌 “학습용” 수준으로 간주한다.

---


**작성:** Fruitables 담당자 · 2025-05-28  
**검토:** (작성 완료 후 TBD)



|순번|요구사항ID|**업무분류 (Level 1 > 2 > 3)**|요구사항명|고객요구사항 상세 내용|1차 분류|2차 분류|
|---|---|---|---|---|---|---|
|1|ACC-01|계정관리 > 회원가입 > 아이디검사|아이디 중복 검사|회원가입 시 `username` 중복 여부를 `GET /accounts/exists` 로 확인|S/W|기능|
|2|ACC-02|계정관리 > 회원가입 > 가입처리|회원 가입|아이디·비밀번호·이름·휴대폰 4개 입력, ID·휴대폰 중복 검사 통과 시 계정 생성|S/W|기능|
|3|ACC-03|계정관리 > 인증 > 로그인|로그인|회원은 `POST /accounts/login`에 ID·PW를 보내 로그인하고 JWT를 받는다|S/W|기능|
|4|ACC-04|계정관리 > 인증 > 아이디찾기|아이디 찾기|이름+휴대폰 입력이 DB 정보와 일치하면 해당 `username` 반환|S/W|기능|
|5|ACC-05|계정관리 > 인증 > 비밀번호찾기|비밀번호 재설정|ID·이름·휴대폰이 일치하면 임시 reset 토큰을 발행해 새 PW 지정|S/W|기능|
|6|ACC-06|계정관리 > 설정 > 비밀번호변경|비밀번호 변경|로그인 사용자가 `PATCH /accounts/password`로 기존 PW 확인 후 새 PW로 변경|S/W|기능|
|7|ACC-07|계정관리 > 관리기능 > 회원목록|회원 목록 조회(관리자)|관리자는 `GET /accounts` 호출 시 전체 회원(페이징) 리스트 조회|S/W|기능|
|8|ACC-08|계정관리 > 관리기능 > 권한검사|관리자 권한 검사|`/accounts` 관리 API는 `role=ADMIN` JWT 클레임이 없으면 403 반환|S/W|기능|
|9|FR-01|상품관리 > 조회 > 목록|상품 목록 조회|사용자는 `GET /fruits`로 모든 과일(이름·가격·재고)을 본다|S/W|기능|
|10|FR-02|상품관리 > 조회 > 상세|상품 상세 조회|`GET /fruits/{id}` 호출 시 존재 여부 검사, 200 또는 404 반환|S/W|기능|
|11|FR-03|상품관리 > 재고 > 차감|재고 차감|주문 성공 후 `PATCH /fruits/{id}/stock`로 재고를 –quantity 한다|S/W|기능|
|12|FR-04|주문관리 > 주문 > 생성|주문 생성|`POST /orders`(fruitId·qty·paymentToken) → 재고확인·token검증·주문저장|S/W|기능|
|13|FR-05|주문관리 > 조회 > 목록|주문 목록 조회|로그인 사용자의 모든 주문을 `GET /orders`로 반환 (페이징)|S/W|기능|
|14|FR-06|주문관리 > 조회 > 상세|주문 상세 조회|`GET /orders/{id}` → 품목·수량·총액·배송상태를 반환|S/W|기능|
|15|FR-07|배송관리 > 시작 > 등록|배송 시작 등록|`POST /delivery/start`(orderId) 호출 시 배송 상태를 READY로 저장|S/W|기능|
|16|FR-08|배송관리 > 조회 > 상태|배송 상태 조회|`GET /delivery/{orderId}` → READY / ON_ROUTE / DELIVERED 중 현재 단계|S/W|기능|
|17|FR-09|배송관리 > 전이 > 수동|배송 상태 전이(수동)|관리/테스트용 `POST /delivery/advance`로 다음 단계로 한 칸 전진|S/W|기능|
|18|FR-10|공통 > API문서 > 제공|API 문서 제공|각 서비스는 OpenAPI 3.1 YAML과 Swagger-UI 엔드포인트를 제공한다|S/W|기능|
|19|NFR-01|품질 > 성능 > 응답시간|API 응답 성능|P95 응답 800 ms 이하, 평균 300 ms 이하|품질|효율성|
|20|NFR-02|품질 > 신뢰성 > 데이터보존|주문·배송 데이터 무손실|장애 후 복구 테스트에서 손실 0건|품질|신뢰성|
|21|NFR-03|품질 > 보안성 > 통신보호|mTLS 적용|서비스 간 트래픽 100 % Istio mTLS|품질|보안성|
|22|NFR-04|품질 > 가용성 > 서비스가용|가용률 99 %|Uptime Robot으로 월간 99 % 보장|품질|신뢰성|
|23|NFR-05|품질 > 사용성 > 추적성|분산 추적 가시화|주문→배송 호출의 90 % 이상 Jaeger Trace 확인|품질|사용성|
|24|NFR-06|품질 > 유지보수성 > 배포|자동 배포 10 분 내|main 머지 → 10 분 내 Jenkins→Argo CD 배포 성공|품질|유지보수성|
|25|NFR-07|품질 > 이식성 > 문서화|OpenAPI 유효성|100 % lint 통과, ReDoc 렌더 정상|품질|이식성|
|26|NFR-08|품질 > 보안성 > 암호화|비밀번호 BCrypt 10↑|계정 PW BCrypt 10R 이상 해시 저장|품질|보안성|
|27|NFR-09|품질 > 보안성 > 인증만료|토큰 만료 정책|Access 30 분, Refresh 7 일·HTTPS-Only Cookie|품질|보안성|
|28|NFR-10|품질 > 보안성 > 개인정보암호화|개인정보 AES256|이름·휴대폰 컬럼을 AES-256 CBC로 암호화해 저장|품질|보안성|

> ● **순번**은 문서 작성·변경 시 자동 증가하도록 유지하세요.  
> ● 업무분류 깊이(Level 3)는 “도메인 > 서브도메인 > 기능” 형태로 맞추었습니다. 필요 시 조직 표준 분류 체계에 맞게 명칭을 교정하면 됩니다.  
> ● 이 표를 스프레드시트로 옮기면 추적·필터링이 편리합니다. 더 세부적인 열(담당자, 개발 난이도, 테스트 방법 등)을 추가해도 좋습니다.

---

1.1 농가 회원 관리 1.1.1 회원가입 화면 개발 1.1.2 파일 업로드 기능 개발 1.1.3 이메일 인증 기능 개발 1.1.4 관리자 승인 기능 개발 1.2 소비자 회원 관리 1.2.1 일반 회원가입 개발 1.2.2 소셜 로그인 연동
이렇게 농가, 소비자 회원을 따로 분리해줘. 그리고 더 디테일한게 있어야지 회원탈퇴, 