## Fruitables — 요구사항 명세서 (v1.0 · 2025-05-28)

> **목적** 이 문서는 _Fruitables_ 시스템이 반드시 충족해야 하는 기능·비기능 요구사항을 정의한다.  
> **범위** FruitCatalog, OrderManager, DeliveryMock 3개 마이크로서비스와 그 외 공통 인프라(Kong GW, RabbitMQ, PostgreSQL 등).

---

### 1. 용어‧약어

|용어|정의|
|---|---|
|**상품**|과일 1종(이름·가격·재고)|
|**주문**|사용자 1회 구매 행위|
|**배송 단계**|`READY → ON_ROUTE → DELIVERED`|
|**paymentToken**|모의 결제 토큰(형식: `tok_test_*`)|

---

### 2. 이해관계자 & 액터

|액터|설명|
|---|---|
|**사용자(Consumer)**|웹 UI로 상품 조회·주문|
|**시스템(Internal)**|서비스 간 재고 차감·배송 전이 동작|
|**관리자(Admin)**|초기 Seed 데이터 입력·재고 조정만 수행|

---

### 3. 기능 요구사항 (FR)

| ID        | 서비스      | 제목        | 상세 설명                                                                             | 우선순위 |
| --------- | -------- | --------- | --------------------------------------------------------------------------------- | ---- |
| **FR-01** | Catalog  | 상품 목록 조회  | `GET /fruits` 호출 시 전체 과일(이름·가격·재고) 반환                                             | ★★★  |
| **FR-02** | Catalog  | 상품 상세 조회  | `GET /fruits/{id}` → 존재하면 200, 없으면 404                                            | ★★★  |
| **FR-03** | Catalog  | 재고 차감     | 주문 성공 시 `PATCH /fruits/{id}/stock` 으로 재고 –quantity                                | ★★★  |
| **FR-04** | Order    | 주문 생성     | `POST /orders`(fruitId, quantity, paymentToken)‣ 재고 확인, token 검증, 주문 저장, 재고 차감 호출 | ★★★  |
| **FR-05** | Order    | 주문 목록     | `GET /orders` → 로그인 사용자의 주문 리스트 반환                                                | ★★   |
| **FR-06** | Order    | 주문 상세     | `GET /orders/{id}` → 상품, 수량, 금액, 배송 status                                        | ★★★  |
| **FR-07** | Delivery | 배송 시작     | `POST /delivery/start`(orderId) → 상태 READY 등록                                     | ★★   |
| **FR-08** | Delivery | 배송 상태 조회  | `GET /delivery/{orderId}` → 현재 단계 문자열 반환                                          | ★★★  |
| **FR-09** | Delivery | 상태 전이(수동) | `POST /delivery/advance`(orderId) → 다음 단계로 1단계 전진                                 | ★    |
| **FR-10** | 공통       | API 문서    | 각 서비스 OpenAPI 3.1 YAML 제공, Swagger-UI로 렌더                                         | ★★★  |

---

### 4. 비기능 요구사항 (NFR)

| ID         | 카테고리 | 요구사항                                  | 검증 방법                 |
| ---------- | ---- | ------------------------------------- | --------------------- |
| **NFR-01** | 성능   | 평균 API 응답 300 ms 이하(P95 800 ms)       | JMeter 부하테스트          |
| **NFR-02** | 신뢰성  | 주문·배송 단계 데이터 손실 0 건                   | k6 chaos 테스트 후 로그 확인  |
| **NFR-03** | 보안   | 서비스 간 통신 Istio mTLS 100 % 적용          | Kiali TLS 댄스그램        |
| **NFR-04** | 가용성  | 클러스터 가용률 99 %+ (단일 VM이지만 재시작 자동)      | UptimeRobot           |
| **NFR-05** | 추적성  | 주문 → 배송 호출이 Jaeger 트레이스에서 90 % 이상 확인  | Jaeger UI 샘플 20건 검토   |
| **NFR-06** | 배포   | `main` 브랜치 머지 후 10 분 이내 자동 배포 성공      | Jenkins·Argo CD 로그    |
| **NFR-07** | 문서화  | OpenAPI YAML 100 % lint 통과 & ReDoc 렌더 | openapi-lint, 브라우저 확인 |

---

### 5. 시스템 인터페이스 요약

|인터페이스|방식|소비자 → 제공자|설명|
|---|---|---|---|
|**API Gateway**|REST/JSON|Browser ↔ Kong|외부 → 내부 서비스 라우팅|
|**Stock Update**|REST (Internal)|Order → Catalog|주문 성공 시 재고 차감|
|**Delivery Trigger**|REST or RabbitMQ 이벤트|Order → Delivery|배송 시작 통보|
|**Metrics**|Prometheus Scrape|각 Pod → Prometheus|`/metrics` 엔드포인트 노출|

---

### 6. 제약 & 가정

1. 인증은 **JWT (모의 서명)** 방식으로 사용자 식별만 수행한다.
    
2. 결제는 **실 PG 미연동**; paymentToken 패턴 검증으로 대체한다.
    
3. 클러스터는 GCP VM 1 노드이므로 고가용성은 아닌 “학습용” 수준으로 간주한다.
    

---

### 7. 향후 확장(Out of Scope v1)

- 실제 PG 연동(토스, 카카오페이 등)
    
- 모바일 전용 앱·PWA
    
- 실배송사 API(로젠, 한진택배) 연결
    

---

**작성:** Fruitables 담당자 · 2025-05-28  
**검토:** (작성 완료 후 TBD)

> 필요에 따라 ID·설명을 세분화하거나, UI Wireframe·ERD 등을 부록으로 추가하시길 권장합니다.