## Fruitables — 요구사항 명세서 (v1.0 · 2025-05-28)

> **목적** 이 문서는 _Fruitables_ 시스템이 반드시 충족해야 하는 기능·비기능 요구사항을 정의한다.  
> **범위** FruitCatalog, OrderManager, DeliveryMock 3개 마이크로서비스와 그 외 공통 인프라(Kong GW, RabbitMQ, PostgreSQL 등).

---

### 1. 용어‧약어

|용어|정의|
|---|---|
|**상품**|과일 1종(이름·가격·재고)|
|**주문**|사용자 1회 구매 행위|
|**배송 단계**|`READY → ON_ROUTE → DELIVERED`|
|**paymentToken**|모의 결제 토큰(형식: `tok_test_*`)|

---

### 2. 이해관계자 & 액터

|액터|설명|
|---|---|
|**사용자(Consumer)**|웹 UI로 상품 조회·주문|
|**시스템(Internal)**|서비스 간 재고 차감·배송 전이 동작|
|**관리자(Admin)**|초기 Seed 데이터 입력·재고 조정만 수행|

---

### 3. 기능 요구사항 (FR)

| ID        | 서비스      | 제목        | 상세 설명                                                                             | 우선순위 |
| --------- | -------- | --------- | --------------------------------------------------------------------------------- | ---- |
| **FR-01** | Catalog  | 상품 목록 조회  | `GET /fruits` 호출 시 전체 과일(이름·가격·재고) 반환                                             | ★★★  |
| **FR-02** | Catalog  | 상품 상세 조회  | `GET /fruits/{id}` → 존재하면 200, 없으면 404                                            | ★★★  |
| **FR-03** | Catalog  | 재고 차감     | 주문 성공 시 `PATCH /fruits/{id}/stock` 으로 재고 –quantity                                | ★★★  |
| **FR-04** | Order    | 주문 생성     | `POST /orders`(fruitId, quantity, paymentToken)‣ 재고 확인, token 검증, 주문 저장, 재고 차감 호출 | ★★★  |
| **FR-05** | Order    | 주문 목록     | `GET /orders` → 로그인 사용자의 주문 리스트 반환                                                | ★★   |
| **FR-06** | Order    | 주문 상세     | `GET /orders/{id}` → 상품, 수량, 금액, 배송 status                                        | ★★★  |
| **FR-07** | Delivery | 배송 시작     | `POST /delivery/start`(orderId) → 상태 READY 등록                                     | ★★   |
| **FR-08** | Delivery | 배송 상태 조회  | `GET /delivery/{orderId}` → 현재 단계 문자열 반환                                          | ★★★  |
| **FR-09** | Delivery | 상태 전이(수동) | `POST /delivery/advance`(orderId) → 다음 단계로 1단계 전진                                 | ★    |
| **FR-10** | 공통       | API 문서    | 각 서비스 OpenAPI 3.1 YAML 제공, Swagger-UI로 렌더                                         | ★★★  |

---

### 4. 비기능 요구사항 (NFR)

| ID         | 카테고리 | 요구사항                                  | 검증 방법                 |
| ---------- | ---- | ------------------------------------- | --------------------- |
| **NFR-01** | 성능   | 평균 API 응답 300 ms 이하(P95 800 ms)       | JMeter 부하테스트          |
| **NFR-02** | 신뢰성  | 주문·배송 단계 데이터 손실 0 건                   | k6 chaos 테스트 후 로그 확인  |
| **NFR-03** | 보안   | 서비스 간 통신 Istio mTLS 100 % 적용          | Kiali TLS 댄스그램        |
| **NFR-04** | 가용성  | 클러스터 가용률 99 %+ (단일 VM이지만 재시작 자동)      | UptimeRobot           |
| **NFR-05** | 추적성  | 주문 → 배송 호출이 Jaeger 트레이스에서 90 % 이상 확인  | Jaeger UI 샘플 20건 검토   |
| **NFR-06** | 배포   | `main` 브랜치 머지 후 10 분 이내 자동 배포 성공      | Jenkins·Argo CD 로그    |
| **NFR-07** | 문서화  | OpenAPI YAML 100 % lint 통과 & ReDoc 렌더 | openapi-lint, 브라우저 확인 |

---

### 5. 시스템 인터페이스 요약

|인터페이스|방식|소비자 → 제공자|설명|
|---|---|---|---|
|**API Gateway**|REST/JSON|Browser ↔ Kong|외부 → 내부 서비스 라우팅|
|**Stock Update**|REST (Internal)|Order → Catalog|주문 성공 시 재고 차감|
|**Delivery Trigger**|REST or RabbitMQ 이벤트|Order → Delivery|배송 시작 통보|
|**Metrics**|Prometheus Scrape|각 Pod → Prometheus|`/metrics` 엔드포인트 노출|

---

### 6. 제약 & 가정

1. 인증은 **JWT (모의 서명)** 방식으로 사용자 식별만 수행한다.
2. 결제는 **실 PG 미연동**; paymentToken 패턴 검증으로 대체한다.
3. 클러스터는 GCP VM 1 노드이므로 고가용성은 아닌 “학습용” 수준으로 간주한다.

---


## 📑 Fruitables — 통합 요구사항 목록 (확장 v2.0 · 2025-05-28)

> **목표** “회원·주문·배송” MVP에 더해  
>   • 농가 회원 전용 흐름 + 소비자 회원 ( 일반·소셜 )  
>   • 주문 변경·취소·회원 탈퇴 등 **경계-Case**  
>   • 클라우드 네이티브 전환·보안·품질·표준 항목  
> 을 **업무 분류 3 단계**·**1/2차 분류** 체계에 맞춰 반영했습니다.  
> (총 **48 건**·순번은 지속적으로 증가하도록 유지)

|순번|요구사항ID|업무분류 (L1 > L2 > L3)|요구사항명|고객요구사항 상세 내용|1차 분류|2차 분류|
|---|---|---|---|---|---|---|
|**계정·인증 도메인**|||||||
|1|FAR-01|농가회원관리 > 가입 > 화면|농가 회원가입 화면|농가용 폼 (ID·PW·이름·휴대폰·농장명) 제공|S/W|기능|
|2|FAR-02|농가회원관리 > 가입 > 파일업로드|농가 증빙 파일 업로드|사업자등록증 JPG/PDF 10 MB 이하 첨부|S/W|데이터|
|3|FAR-03|농가회원관리 > 가입 > 이메일인증|이메일 인증|가입 후 10 분 유효 1-회 토큰 메일 발송|S/W|기능|
|4|FAR-04|농가회원관리 > 가입 > 관리자승인|관리자 승인|관리자가 서류 확인 후 `role=FARMER` 부여|S/W|기능|
|5|CON-01|소비자회원관리 > 일반가입 > 화면|일반 회원가입|ID·PW·이름·휴대폰 입력, 중복검사 포함|S/W|기능|
|6|CON-02|소비자회원관리 > 소셜로그인 > OAuth|소셜 로그인|Google / Naver OAuth2 Login, 최초 시 자동 회원등록|S/W|기능|
|7|ACC-10|계정관리 > 탈퇴 > 소비자|소비자 회원 탈퇴|로그인 사용자가 비밀번호 확인 후 `status=DELETED`|S/W|기능|
|8|ACC-11|계정관리 > 탈퇴 > 농가|농가 회원 탈퇴|미처리 주문 0 건 조건, 탈퇴 시 모든 상품 비공개|S/W|기능|
|9|ACC-12|계정관리 > 보안 > 세션관리|토큰 재사용 방지|Access Token 재발급 시 이전 Refresh 토큰 폐기|품질|보안성|
|10|ACC-13|계정관리 > 보안 > 개인정보파기|탈퇴 후 개인정보 파기|탈퇴 5 일 내 암호화 값 삭제 & DB 물리 삭제|품질|보안성|
|**상품·주문·배송 도메인**|||||||
|11|FR-01|상품관리 > 조회 > 목록|상품 목록 조회|`GET /fruits`|S/W|기능|
|12|FR-03|상품관리 > 재고 > 차감|재고 차감|주문 성공 시 –qty|S/W|기능|
|13|ORD-01|주문관리 > 주문 > 생성|주문 생성|…paymentToken 검증 포함|S/W|기능|
|14|ORD-02|주문관리 > 주문 > 수정|주문 변경|`status=READY` 상태에서만 qty 변경 가능|S/W|기능|
|15|ORD-03|주문관리 > 주문 > 취소|주문 취소|`status=READY` 상태에서 취소 → 재고 복원|S/W|기능|
|16|ORD-04|주문관리 > 정산 > 농가정산|농가 정산 금액 계산|배송 완료 후 판매가 × 수수료 계산 API|S/W|기능|
|17|DEL-01|배송관리 > 시작 > 등록|배송 시작|POST /delivery/start|S/W|기능|
|18|DEL-03|배송관리 > 알림 > Webhook|배송 상태 Webhook|상태 전이 시 RabbitMQ 이벤트 & Webhook 호출|S/W|기능|
|**API·데이터 표준**|||||||
|19|API-01|API문서 > 표준 > OpenAPI|OpenAPI 3.1 작성|lint 0 error, ReDoc 렌더|S/W|기능|
|20|DAT-01|데이터표준 > 코드 > 공통코드|공통 코드 관리|과일분류, 주문상태 등 코드테이블 중앙관리|S/W|데이터|
|21|DAT-02|데이터표준 > 표준화 > UTF-8|캐릭터셋 UTF-8|모든 서비스 & DB UTF-8 인코딩|품질|이식성|
|**클라우드 네이티브·DevSecOps**|||||||
|22|CNS-01|클라우드전환 > 컨테이너화 > 12-Factor|12-Factor 준수|Code-Config 분리, Stateless, Env Vars 사용|품질|유지보수성|
|23|CNS-02|클라우드전환 > 오픈소스 > 라이선스|OSS 라이선스 준수|SPDX SBOM 제출, Trivy --license 스캔 0 High|품질|보안성|
|24|CNS-03|클라우드전환 > 이식성 > OCI|OCI 이미지 호환|Harbor push 시 manifest v2 스펙 준수|품질|이식성|
|25|DEV-01|DevSecOps > CI/CD > Jenkins|CI 파이프라인|main push → 테스트·Trivy·빌드 자동화|S/W|기능|
|26|DEV-02|DevSecOps > CD > Argo|CD 파이프라인|이미지 태그 변경 시 ArgoCD 자동Deploy|S/W|기능|
|27|DEV-03|DevSecOps > SCA > Trivy|이미지 취약점 스캔|High 이상 0 건 시만 Deploy 허용|품질|보안성|
|**성능·품질·테스트**|||||||
|28|PERF-01|성능 > 부하 > JMeter|JMeter 시나리오|200 TPS, 오류율 < 1 %|품질|효율성|
|29|PERF-02|성능 > 페이지로드 > Web|웹 디스플레이 시간|FCP < 1.5 s, TTI < 3 s (PC / 모바일)|품질|효율성|
|30|TEST-01|테스트 > 전략 > 종합|테스트 전략 수립|단위·통합·E2E·Chaos 포함, 문서화|기타|기타|
|31|TEST-02|테스트 > 품질보증 > 결함관리|결함 관리|JIRA 기준 Critical 버그 0 건 배포|품질|신뢰성|
|**보안·규정·표준 준수**|||||||
|32|SEC-01|접근제어 > 최소권한|최소 권한 원칙|DB·K8s RBAC 최소화|품질|보안성|
|33|SEC-02|개인정보 > 로그보관|접속기록 1년 보관|Loki log retention 380 일|품질|보안성|
|34|SEC-03|개발보안 > 취약점점검|코드 취약점 점검|SonarQube Bugs A, Vulnerabilities A|품질|보안성|
|35|GOV-01|규정 > 웹표준 > ActiveX 금지|ActiveX 지양|순수 HTML5, No NPAPI|품질|사용성|
|36|GOV-02|규정 > 접근성 > WA 인증|웹 접근성|KWCAG 2.1 AA 준수|품질|사용성|
|**운영·장애·지원**|||||||
|37|OPS-01|장애대응 > RTO/RPO|장애 복구|RTO 1 h, RPO 10 min, 백업 CronJob|품질|신뢰성|
|38|OPS-02|사고대응 > 알림|장애 알림|Prometheus Alert → Slack 5 min 내|품질|신뢰성|
|39|OPS-03|유지보수 > 하자보수|하자보수 계획|하자 기간 3 개월, 버그 패치 SLA D+1|기타|기타|
|**프로젝트·산출물·관리**|||||||
|40|PM-01|PM > 일정 > 보고체계|주간·월간 보고|PM→Stakeholder, 포맷 A4 2 p|기타|기타|
|41|PM-02|PM > 산출물 > 형상관리|산출물 관리|Git tag + 파일서버 이중 보관|기타|기타|
|42|PM-03|인력 > 투입 > 근로시간|52 시간 준수|Timesheet 제출|기타|기타|
|43|PM-04|교육 > 기술전수 > 농가|교육 계획|농가 대상 주문·재고 관리 매뉴얼 제공|기타|기타|
|44|PM-05|비용 > 효과분석|비용-편익 분석|클라우드 전환 前/後 TCO 비교 보고서|기타|기타|
|**데이터 이관·표준화**|||||||
|45|MIG-01|데이터이관 > 계획 > 이관전략|데이터 이관 전략|CSV→PSQL, 검증 SQL 포함|기타|데이터|
|46|MIG-02|데이터이관 > 검증 > 샘플검증|샘플 검증|5 % 샘플 레코드 diff=0|기타|데이터|
|**호환·이식성**|||||||
|47|COMP-01|호환성 > 브라우저 > 크로스플랫폼|크로스 브라우저|Chrome·Edge·Safari·Mobile 지원|품질|이식성|
|48|COMP-02|호환성 > 단말 > 반응형|반응형 UI|360 px~1920 px 해상도 대응|품질|사용성|

> **활용 방법**  
> • 스프레드시트로 복사 후 **필터/피벗**으로 관리  
> • 추가 열(담당자, 개발 난이도, 예정·실적 일자 등)을 삽입해 **WBS**와 연결  
> • 요구사항 상태(Planned/In Progress/Done) 활용 시 **추적 매트릭스** 바로 생성 가능

필요에 따라 더 세분화하거나 우선순위·분류 체계를 변경하시면 됩니다.  
다음으로 **WBS 세부 작업**·**OpenAPI YAML**·**테스트 플랜** 등이 필요하시면 알려 주세요!