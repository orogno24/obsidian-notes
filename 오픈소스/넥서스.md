## Nexus Repository란?

**멀티포맷 아티팩트 저장소** - 개발에 필요한 모든 라이브러리와 파일을 중앙에서 관리하는 도구
### 왜 필요한가?

```
문제: 개발자들이 각자 외부에서 라이브러리 다운로드
해결: 내부 서버에 모아두고 한 곳에서 관리
```
### 기본 vs Nexus

```yaml
기본 방식:
  개발자 → Maven Central (외부) → 라이브러리 다운로드

Nexus 방식:
  개발자 → Nexus (내부) → Maven Central → 라이브러리 다운로드
          ↑ 캐시/관리      ↑ 첫 번째만
```

## 주요 기능

### 1. **프록시 & 캐싱**

- 외부 저장소(Maven Central, npm Registry)의 캐시 역할
- 한 번 다운로드하면 내부에서 재사용

### 2. **멀티포맷 지원**

- Docker 이미지
- Maven (Java)
- npm (Node.js)
- PyPI (Python)
- NuGet (.NET)
- Helm 차트

### 3. **사내 라이브러리 저장**

- 내부에서 개발한 라이브러리 공유
- 팀 간 코드 재사용

## 사용 시나리오

### **개인/소규모 팀**

```
사용 안함 (95%)
→ Maven Central 직접 사용
→ 설정 간단, 비용 없음
```

### **중대형 기업**

```
사용함 (80%)
→ 보안 정책, 망분리 환경
→ 네트워크 효율성, 통제 필요
```

## 실제 설정 예시

### **Maven 설정**

```xml
<!-- pom.xml -->
<project>
    <!-- Repository 설정: 어디서 가져올지 -->
    <repositories>
        <repository>
            <id>nexus</id>
            <url>http://nexus.company.com:8081/repository/maven-public/</url>
        </repository>
    </repositories>
    
    <!-- 의존성 선언: 무엇을 가져올지 -->
    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>5.3.21</version>
        </dependency>
    </dependencies>
</project>
```

### 빌드 시 동작

```bash
mvn clean compile
↓
Maven: pom.xml에서 의존성 목록 확인
↓  
Maven: "spring-core 5.3.21이 필요하네"
↓
Maven: Repository 설정 확인 → Nexus 서버 접근
↓
Nexus: spring-core 있는지 확인
  - 있으면: 바로 전달
  - 없으면: Maven Central에서 다운로드 후 캐시하고 전달
↓
빌드 완료
```

## 장단점

### **장점**

- 🚀 빠른 다운로드 (내부 네트워크)
- 🔒 보안 통제 (승인된 라이브러리만)
- 📦 통합 관리 (모든 아티팩트 한 곳에)
- 🏢 사내 라이브러리 공유

### **단점**

- 💰 비용 (서버, 관리 인력)
- ⚙️ 설정 복잡성
- 🔧 유지보수 필요

## 경쟁 제품 비교

|제품|특징|사용 환경|
|---|---|---|
|**Nexus**|멀티포맷, 기업급|대기업, CI/CD 중심|
|**Harbor**|컨테이너 전문|쿠버네티스 환경|
|**Docker Hub**|퍼블릭 클라우드|개인, 소규모|

## 핵심 포인트

```yaml
언제 사용?: 
  - 기업 환경 (보안 정책)
  - 팀 규모 큼 (효율성)
  - 망분리 환경 (접근 제한)
  - 사내 라이브러리 공유

왜 사용?:
  - 의존성 "정보"는 코드에, "파일"은 별도 관리
  - 외부 의존성 없는 안정적 빌드
  - 중앙집중식 아티팩트 관리
```

**한줄 요약**: 개발팀의 모든 라이브러리를 안전하고 효율적으로 관리하는 내부 저장소

---
# 📝 Nexus Docker Registry 운영 메모

## 🎯 목표

쿠버네티스 환경에서 Nexus를 Docker 이미지 저장소로 사용하고, 기존 VM에서 관리하던 이미지를 새 환경으로 안전하게 이전한다.

## 🟢 Nexus 설치 구조

### ✅ 기존 VM Nexus

- 회사에서 직접 VM에 Nexus를 설치해 운영.
- 접속 URL:
    ```
    https://14.63.177.157:8443/
    ```
- Repository에 기존 Docker 이미지가 저장되어 있음.
- 목적: **이 이미지들을 파드로 배포된 Nexus로 마이그레이션**

---

### ✅ 쿠버네티스 Nexus

- Helm Chart로 설치

- 서비스 노출 방식:

    - NodePort 30018 (HTTP Docker Port)
    - NodePort 30443 (HTTPS Docker Port)
    - ClusterIP 8081 (웹 UI/REST API)

- Ingress도 배포되어 있으나 EXTERNAL-IP는 없음 (NodePort만 노출 중)

---

## 🟢 마이그레이션 목적

- 기존 VM Nexus에 저장된 이미지 정보를 **쿠버네티스 Nexus로 이전**.
- 새 환경에 동일한 이미지 네임과 태그로 저장.
- 이후 구축된 쿠버네티스 클러스터에서 일관되게 Pull 가능.

---
### NodePort (HTTPS) 방식

- 포트: `30443`
- HTTPS 인증서 CN/SAN 주의

- 예시:
    ```bash
    sudo nerdctl tag nginx 172.25.0.84:30443/myimage/nginx:latest
    sudo nerdctl push 172.25.0.84:30443/myimage/nginx:latest
    ```

---

### Ingress Subpath 방식

- DNS가 Ingress에 연결되어야 함
- `/etc/hosts`에 Ingress Node IP 등록 필요

- 예시 `/etc/hosts`:
    ```
    172.25.0.96 repository.dev.eris.go.kr
    ```

- 예시 Push:
    ```bash
    sudo nerdctl tag nginx repository.dev.eris.go.kr/my-repo/nginx:latest
    sudo nerdctl push repository.dev.eris.go.kr/my-repo/nginx:latest
    ```
- Repository가 `my-repo`로 구분됨.

---

# 넥서스 명령어
## 🟢 1️⃣ nerdctl 로그인

bash

복사편집

`nerdctl login --insecure-registry 10.100.0.102:32415`

✅ 프롬프트가 나오면 입력:

makefile

복사편집

`Username: admin Password: <Nexus 비밀번호>`

---

## 🟢 2️⃣ 이미지 태그 지정

예를 들어 busybox 이미지를 태그하려면:

bash

복사편집

`nerdctl tag busybox:latest 10.100.0.102:32415/my-docker-image/busybox:latest`

> `my-docker-image` = Nexus에 만든 Docker hosted repo 이름

---

## 🟢 3️⃣ 이미지 푸시

bash

복사편집

`nerdctl --insecure-registry push 10.100.0.102:32415/my-docker-image/busybox:latest`

---

## ✅ 예제 전체 순서 한눈에 보기

아래 명령어 그대로 순서대로 실행하시면 됩니다:

bash

복사편집

`nerdctl login --insecure-registry 10.100.0.102:32415  nerdctl tag busybox:latest 10.100.0.102:32415/my-docker-image/busybox:latest  nerdctl --insecure-registry push 10.100.0.102:32415/my-docker-image/busybox:latest`