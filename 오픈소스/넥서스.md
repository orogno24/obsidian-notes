Nexus RepositoryëŠ” ê°œë°œì— í•„ìš”í•œ ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ íŒŒì¼ì„ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ëŠ” **ë©€í‹°í¬ë§· ì•„í‹°íŒ©íŠ¸ ì €ì¥ì†Œ**ì…ë‹ˆë‹¤.

## ì™œ Nexusê°€ í•„ìš”í•œê°€?

### ë¬¸ì œì 
ê°œë°œìë“¤ì´ ê°ì ì™¸ë¶€ ì €ì¥ì†Œì—ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ê´€ë¦¬ê°€ ì–´ë µê³  ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.

### í•´ê²°ì±…
ë‚´ë¶€ ì„œë²„ì— ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ëª¨ì•„ë‘ê³  í•œ ê³³ì—ì„œ ì¤‘ì•™ ê´€ë¦¬í•©ë‹ˆë‹¤.

### ê¸°ë³¸ ë°©ì‹ vs Nexus ë°©ì‹

```yaml
ê¸°ë³¸ ë°©ì‹:
  ê°œë°œì â†’ Maven Central (ì™¸ë¶€) â†’ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‹¤ìš´ë¡œë“œ

Nexus ë°©ì‹:
  ê°œë°œì â†’ Nexus (ë‚´ë¶€) â†’ Maven Central â†’ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‹¤ìš´ë¡œë“œ
          â†‘ ìºì‹œ/ê´€ë¦¬      â†‘ ì²« ë²ˆì§¸ë§Œ
```

## ì£¼ìš” ê¸°ëŠ¥

### 1. í”„ë¡ì‹œ & ìºì‹±
- ì™¸ë¶€ ì €ì¥ì†Œ(Maven Central, npm Registry)ì˜ ìºì‹œ ì—­í• 
- í•œ ë²ˆ ë‹¤ìš´ë¡œë“œí•˜ë©´ ë‚´ë¶€ì—ì„œ ì¬ì‚¬ìš©

### 2. ë©€í‹°í¬ë§· ì§€ì›
- **Docker ì´ë¯¸ì§€**: ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì €ì¥
- **Maven (Java)**: Java ë¼ì´ë¸ŒëŸ¬ë¦¬
- **npm (Node.js)**: JavaScript íŒ¨í‚¤ì§€
- **PyPI (Python)**: Python íŒ¨í‚¤ì§€
- **NuGet (.NET)**: .NET íŒ¨í‚¤ì§€
- **Helm ì°¨íŠ¸**: ì¿ ë²„ë„¤í‹°ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ¨í‚¤ì§€

### 3. ì‚¬ë‚´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì €ì¥
- ë‚´ë¶€ì—ì„œ ê°œë°œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê³µìœ 
- íŒ€ ê°„ ì½”ë“œ ì¬ì‚¬ìš©

## ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ê°œì¸/ì†Œê·œëª¨ íŒ€ (95% ì‚¬ìš© ì•ˆí•¨)
- Maven Central ì§ì ‘ ì‚¬ìš©
- ì„¤ì • ê°„ë‹¨, ë¹„ìš© ì—†ìŒ

### ì¤‘ëŒ€í˜• ê¸°ì—… (80% ì‚¬ìš©)
- ë³´ì•ˆ ì •ì±…, ë§ë¶„ë¦¬ í™˜ê²½
- ë„¤íŠ¸ì›Œí¬ íš¨ìœ¨ì„±, í†µì œ í•„ìš”

## ì‹¤ì œ ì„¤ì • ì˜ˆì‹œ

### Maven ì„¤ì •

```xml
<!-- pom.xml -->
<project>
    <!-- Repository ì„¤ì •: ì–´ë””ì„œ ê°€ì ¸ì˜¬ì§€ -->
    <repositories>
        <repository>
            <id>nexus</id>
            <url>http://nexus.company.com:8081/repository/maven-public/</url>
        </repository>
    </repositories>
    
    <!-- ì˜ì¡´ì„± ì„ ì–¸: ë¬´ì—‡ì„ ê°€ì ¸ì˜¬ì§€ -->
    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>5.3.21</version>
        </dependency>
    </dependencies>
</project>
```

### ë¹Œë“œ ì‹œ ë™ì‘ ê³¼ì •

```bash
mvn clean compile
â†“
Maven: pom.xmlì—ì„œ ì˜ì¡´ì„± ëª©ë¡ í™•ì¸
â†“  
Maven: "spring-core 5.3.21ì´ í•„ìš”í•˜ë„¤"
â†“
Maven: Repository ì„¤ì • í™•ì¸ â†’ Nexus ì„œë²„ ì ‘ê·¼
â†“
Nexus: spring-core ìˆëŠ”ì§€ í™•ì¸
  - ìˆìœ¼ë©´: ë°”ë¡œ ì „ë‹¬
  - ì—†ìœ¼ë©´: Maven Centralì—ì„œ ë‹¤ìš´ë¡œë“œ í›„ ìºì‹œí•˜ê³  ì „ë‹¬
â†“
ë¹Œë“œ ì™„ë£Œ
```

## Helm ë ˆí¬ì§€í† ë¦¬ ê¸°ëŠ¥

### Helm ì°¨íŠ¸ ì €ì¥ì†Œ ì—­í• 
NexusëŠ” Helm ì°¨íŠ¸ë¥¼ ì €ì¥í•˜ê³  ë°°í¬í•  ìˆ˜ ìˆëŠ” ë ˆí¬ì§€í† ë¦¬ ì—­í• ì„ í•©ë‹ˆë‹¤.

### Helm ë ˆí¬ì§€í† ë¦¬ ì¶”ê°€ ë°©ë²•

1. **Nexusì—ì„œ Helm ë ˆí¬ì§€í† ë¦¬ ìƒì„±**
   - Nexus UIì—ì„œ Helm hosted ë ˆí¬ì§€í† ë¦¬ ìƒì„±
   - ì˜ˆ: `my-helm-repo`

2. **ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ Helm ë ˆí¬ì§€í† ë¦¬ ë“±ë¡**
   ```bash
   helm repo add my-nexus http://nexus.company.com:8081/repository/my-helm-repo/
   helm repo update
   ```

3. **Helm ì°¨íŠ¸ ì‚¬ìš©**
   ```bash
   # ë ˆí¬ì§€í† ë¦¬ ëª©ë¡ í™•ì¸
   helm repo list
   
   # ë ˆí¬ì§€í† ë¦¬ì˜ ì°¨íŠ¸ ëª©ë¡ í™•ì¸
   helm search repo my-nexus
   
   # ì°¨íŠ¸ ì„¤ì¹˜
   helm install my-app my-nexus/my-chart
   ```

### Helm ì°¨íŠ¸ ì—…ë¡œë“œ ë°©ë²•

```bash
# Helm ì°¨íŠ¸ íŒ¨í‚¤ì§•
helm package my-chart/

# Nexusì— ì—…ë¡œë“œ (curl ì‚¬ìš©)
curl -u admin:password -X POST \
  "http://nexus.company.com:8081/service/rest/v1/components?repository=my-helm-repo" \
  -H "accept: application/json" \
  -H "Content-Type: multipart/form-data" \
  -F "helm.asset=@my-chart-1.0.0.tgz"
```

## ì¥ë‹¨ì 

### ì¥ì 
- ğŸš€ ë¹ ë¥¸ ë‹¤ìš´ë¡œë“œ (ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬)
- ğŸ”’ ë³´ì•ˆ í†µì œ (ìŠ¹ì¸ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë§Œ)
- ğŸ“¦ í†µí•© ê´€ë¦¬ (ëª¨ë“  ì•„í‹°íŒ©íŠ¸ í•œ ê³³ì—)
- ğŸ¢ ì‚¬ë‚´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê³µìœ 

### ë‹¨ì 
- ğŸ’° ë¹„ìš© (ì„œë²„, ê´€ë¦¬ ì¸ë ¥)
- âš™ï¸ ì„¤ì • ë³µì¡ì„±
- ğŸ”§ ìœ ì§€ë³´ìˆ˜ í•„ìš”

## ê²½ìŸ ì œí’ˆ ë¹„êµ

| ì œí’ˆ | íŠ¹ì§• | ì‚¬ìš© í™˜ê²½ |
|------|------|-----------|
| **Nexus** | ë©€í‹°í¬ë§·, ê¸°ì—…ê¸‰ | ëŒ€ê¸°ì—…, CI/CD ì¤‘ì‹¬ |
| **Harbor** | ì»¨í…Œì´ë„ˆ ì „ë¬¸ | ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ |
| **Docker Hub** | í¼ë¸”ë¦­ í´ë¼ìš°ë“œ | ê°œì¸, ì†Œê·œëª¨ |

## í•µì‹¬ í¬ì¸íŠ¸

```yaml
ì–¸ì œ ì‚¬ìš©?: 
  - ê¸°ì—… í™˜ê²½ (ë³´ì•ˆ ì •ì±…)
  - íŒ€ ê·œëª¨ í¼ (íš¨ìœ¨ì„±)
  - ë§ë¶„ë¦¬ í™˜ê²½ (ì ‘ê·¼ ì œí•œ)
  - ì‚¬ë‚´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê³µìœ 

ì™œ ì‚¬ìš©?:
  - ì˜ì¡´ì„± "ì •ë³´"ëŠ” ì½”ë“œì—, "íŒŒì¼"ì€ ë³„ë„ ê´€ë¦¬
  - ì™¸ë¶€ ì˜ì¡´ì„± ì—†ëŠ” ì•ˆì •ì  ë¹Œë“œ
  - ì¤‘ì•™ì§‘ì¤‘ì‹ ì•„í‹°íŒ©íŠ¸ ê´€ë¦¬
```

**í•œì¤„ ìš”ì•½**: ê°œë°œíŒ€ì˜ ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì•ˆì „í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ë‚´ë¶€ ì €ì¥ì†Œ

---

# Nexus Docker Registry ìš´ì˜ ê°€ì´ë“œ

## ëª©í‘œ

ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ Nexusë¥¼ Docker ì´ë¯¸ì§€ ì €ì¥ì†Œë¡œ ì‚¬ìš©í•˜ê³ , ê¸°ì¡´ VMì—ì„œ ê´€ë¦¬í•˜ë˜ ì´ë¯¸ì§€ë¥¼ ìƒˆ í™˜ê²½ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì´ì „í•©ë‹ˆë‹¤.

## ì„¤ì¹˜ êµ¬ì¡°

### ê¸°ì¡´ VM Nexus
- íšŒì‚¬ì—ì„œ ì§ì ‘ VMì— Nexus ì„¤ì¹˜ ìš´ì˜
- ì ‘ì† URL: `https://14.63.177.157:8443/`
- Repositoryì— ê¸°ì¡´ Docker ì´ë¯¸ì§€ ì €ì¥
- **ëª©ì **: ì´ ì´ë¯¸ì§€ë“¤ì„ íŒŒë“œë¡œ ë°°í¬ëœ Nexusë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

### ì¿ ë²„ë„¤í‹°ìŠ¤ Nexus
- Helm Chartë¡œ ì„¤ì¹˜
- ì„œë¹„ìŠ¤ ë…¸ì¶œ ë°©ì‹:
  - NodePort 30018 (HTTP Docker Port)
  - NodePort 30443 (HTTPS Docker Port)
  - ClusterIP 8081 (ì›¹ UI/REST API)
- Ingress ë°°í¬ë˜ì–´ ìˆìœ¼ë‚˜ EXTERNAL-IP ì—†ìŒ (NodePortë§Œ ë…¸ì¶œ)

## ë§ˆì´ê·¸ë ˆì´ì…˜ ëª©ì 

- ê¸°ì¡´ VM Nexusì— ì €ì¥ëœ ì´ë¯¸ì§€ ì •ë³´ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ Nexusë¡œ ì´ì „
- ìƒˆ í™˜ê²½ì— ë™ì¼í•œ ì´ë¯¸ì§€ ë„¤ì„ê³¼ íƒœê·¸ë¡œ ì €ì¥
- ì´í›„ êµ¬ì¶•ëœ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì¼ê´€ë˜ê²Œ Pull ê°€ëŠ¥

## ì ‘ê·¼ ë°©ì‹

### NodePort (HTTPS) ë°©ì‹
- í¬íŠ¸: `30443`
- HTTPS ì¸ì¦ì„œ CN/SAN ì£¼ì˜

```bash
sudo nerdctl tag nginx 172.25.0.84:30443/myimage/nginx:latest
sudo nerdctl push 172.25.0.84:30443/myimage/nginx:latest
```

### Ingress Subpath ë°©ì‹
- DNSê°€ Ingressì— ì—°ê²°ë˜ì–´ì•¼ í•¨
- `/etc/hosts`ì— Ingress Node IP ë“±ë¡ í•„ìš”

**ì˜ˆì‹œ `/etc/hosts`:**
```
172.25.0.96 repository.dev.eris.go.kr
```

**ì˜ˆì‹œ Push:**
```bash
sudo nerdctl tag nginx repository.dev.eris.go.kr/my-repo/nginx:latest
sudo nerdctl push repository.dev.eris.go.kr/my-repo/nginx:latest
```

Repositoryê°€ `my-repo`ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤.

## ê¸°ë³¸ ëª…ë ¹ì–´

### 1. nerdctl ë¡œê·¸ì¸
```bash
nerdctl login --insecure-registry 10.100.0.102:32415
```

í”„ë¡¬í”„íŠ¸ê°€ ë‚˜ì˜¤ë©´ ì…ë ¥:
```
Username: admin
Password: <Nexus ë¹„ë°€ë²ˆí˜¸>
```

### 2. ì´ë¯¸ì§€ íƒœê·¸ ì§€ì •
```bash
nerdctl tag busybox:latest 10.100.0.102:32415/my-docker-image/busybox:latest
```

> `my-docker-image` = Nexusì— ë§Œë“  Docker hosted repo ì´ë¦„

### 3. ì´ë¯¸ì§€ í‘¸ì‹œ
```bash
nerdctl --insecure-registry push 10.100.0.102:32415/my-docker-image/busybox:latest
```

### 4. ì´ë¯¸ì§€ í’€
```bash
nerdctl --insecure-registry pull 10.100.0.102:32415/my-docker-image/busybox:latest
```

> `--insecure-registry` ê¼­ í•„ìš”í•¨ (HTTP ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¼ì„œ)

### 5. ì´ë¯¸ì§€ í™•ì¸
```bash
nerdctl images
```

## ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ: cert-manager ì´ë¯¸ì§€ ì´ê´€

### 1. í•„ìš”í•œ ì´ë¯¸ì§€ Pull
```bash
nerdctl pull quay.io/jetstack/cert-manager-cainjector:v1.14.4
```

### 2. ì´ë¯¸ì§€ì— ìƒˆë¡œìš´ íƒœê·¸ ë‹¬ê¸°
```bash
nerdctl tag quay.io/jetstack/cert-manager-cainjector:v1.14.4 \
  10.100.0.102:32415/my-docker-image/cert-manager-cainjector:v1.14.4
```

### 3. Nexusì— Push
```bash
# Nexus ë¡œê·¸ì¸
nerdctl login --insecure-registry 10.100.0.102:32415

# ì´ë¯¸ì§€ Push
nerdctl --insecure-registry push 10.100.0.102:32415/my-docker-image/cert-manager-cainjector:v1.14.4
```

### 4. YAML íŒŒì¼ì˜ ì´ë¯¸ì§€ ê²½ë¡œ ìˆ˜ì •

**ê¸°ì¡´:**
```yaml
image: "quay.io/jetstack/cert-manager-cainjector:v1.14.4"
```

**ë³€ê²½:**
```yaml
image: "10.100.0.102:32415/my-docker-image/cert-manager-cainjector:v1.14.4"
```

### 5. ì¿ ë²„ë„¤í‹°ìŠ¤ì— ì ìš©
```bash
kubectl apply -f cert-manager.yaml
```

ì´ì œ ì¸í„°ë„·ì´ ëŠì–´ì ¸ë„ Nexusì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Push ì‹¤íŒ¨ ì‹œ í•´ê²° ë°©ë²•

**ì—ëŸ¬ ë©”ì‹œì§€:**
```
server "172.25.0.84:30018" does not seem to support HTTPS, falling back to plain HTTP
error="failed to do request: Head \"https://172.25.0.84:30018/...\": http: server gave HTTP response to HTTPS client"
```

**í•´ê²° ë°©ë²•:**

1. **containerd ì„¤ì • íŒŒì¼ ìƒì„±**
   ```bash
   sudo mkdir -p /etc/containerd/certs.d/172.25.0.84:30018
   sudo vi /etc/containerd/certs.d/172.25.0.84:30018/hosts.toml
   ```

2. **ì„¤ì • ë‚´ìš©**
   ```
   server = "http://172.25.0.84:30018"

   [host."http://172.25.0.84:30018"]
     capabilities = ["pull", "resolve", "push"]
     skip_verify = true
   ```

3. **containerd ì¬ì‹œì‘**
   ```bash
   sudo systemctl restart containerd
   ```

## ìš”ì•½

**Pull** â†’ **Tag** â†’ **Push** â†’ **YAML ìˆ˜ì •** â†’ **ì ìš©**

ì´ ê³¼ì •ì„ í†µí•´ ì™¸ë¶€ ì˜ì¡´ì„± ì—†ì´ ë‚´ë¶€ Nexusì—ì„œ ëª¨ë“  ì´ë¯¸ì§€ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.