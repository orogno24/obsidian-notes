## 라이프사이클 관리의 이해

### 릴리스(Release)의 개념

- **릴리스란?** 차트 설치 시 생성되는 쿠버네티스 객체 모음
- **특징**:
    - 애플리케이션과 유사하지만 쿠버네티스 객체 집합을 의미
    - Helm은 각 릴리스에 속한 객체를 추적 관리
    - 동일한 차트 기반이라도 각 릴리스는 독립적으로 관리 가능

## 실습: Nginx 릴리스 관리

### 특정 버전 차트 설치

```bash
helm install nginx-release bitnami/nginx --version 6.0.0
```

- `--version` 옵션으로 특정 차트 버전 지정 가능
- 이 예시에서는 의도적으로 오래된 버전 설치

### 현재 버전 확인

1. 파드 이름 확인:
    
    ```bash
    kubectl get pods
    ```
    
2. 파드 세부 정보 확인:
    
    ```bash
    kubectl describe pod [파드_이름]
    ```
    
    - 결과: Nginx 버전 1.19.2 실행 중 (오래된 버전)

### 릴리스 업그레이드

```bash
helm upgrade nginx-release bitnami/nginx
```

- 단일 명령어로 릴리스의 모든 객체 업그레이드
- 결과: 리비전 1 → 리비전 2로 변경

### 업그레이드 확인

1. 새 파드 이름 확인:
    
    ```bash
    kubectl get pods
    ```
    
2. 새 파드 세부 정보 확인:
    
    ```bash
    kubectl describe pod [새_파드_이름]
    ```
    
    - 결과: Nginx 버전 1.21.4 실행 중 (새 버전)

## 릴리스 이력 관리

### 현재 릴리스 목록 확인

```bash
helm list
```

- 설치된 모든 릴리스와 현재 리비전 번호 표시

### 릴리스 이력 조회

```bash
helm history nginx-release
```

- 상세 정보 표시:
    - 각 리비전의 차트 버전
    - 앱 버전
    - 리비전 생성 액션(설치, 업그레이드, 롤백)
    - 배포 상태
    - 타임스탬프

## 롤백(Rollback) 기능

### 이전 리비전으로 롤백

```bash
helm rollback nginx-release 1
```

- `nginx-release`를 리비전 1로 롤백
- 주의: 실제로는 새 리비전(리비전 3)이 생성됨

### 롤백 확인

```bash
helm history nginx-release
```

- 결과: 3개의 리비전 표시
    - 리비전 1: 초기 설치
    - 리비전 2: 업그레이드
    - 리비전 3: 리비전 1로 롤백 (설명에 롤백 정보 포함)

## 실제 사용 시 고려사항

### 복잡한 애플리케이션 업그레이드

- 일부 애플리케이션(예: WordPress)은 추가 매개변수 필요
- 관리자 비밀번호 같은 인증 정보가 필요할 수 있음
- 예시 에러 메시지:
    
    ```
    Error: UPGRADE FAILED: values don't meet the specifications of the schema...
    ```
    
- 해결: 명령줄에 필요한 매개변수 추가

### 롤백의 한계

- 롤백은 **매니페스트 파일만** 복원
- 다음 데이터는 복원되지 않음:
    - 애플리케이션이 생성한 파일/디렉토리 데이터
    - 영구 볼륨(PV)에 저장된 데이터
    - 외부 데이터베이스 데이터
- **예시**: MySQL 데이터베이스 롤백
    - MySQL 파드는 이전 상태로 복원됨
    - 소프트웨어 버전은 이전으로 돌아감
    - 실제 데이터베이스 내용은 변경되지 않음

### 데이터 백업 및 복원

- 차트 업그레이드 전 데이터베이스 일관성 있는 백업 가능
- 데이터베이스 롤백/복원은 차트 훅(Chart Hooks) 사용
- 차트 훅은 강의 후반부에서 다룸

## 요약

Helm의 라이프사이클 관리는 쿠버네티스 애플리케이션의 배포, 업그레이드, 롤백을 단순화합니다. 각 변경사항은 새로운 리비전으로 기록되며, `helm history` 명령으로 변경 이력을 추적할 수 있습니다. 롤백 기능은 이전 버전으로 쉽게 되돌릴 수 있게 해주지만, 영구 데이터는 복원하지 않는다는 제한사항이 있습니다.

---

## 주요 명령어 정리

- `helm install [릴리스명] [차트명] --version [버전]`: 특정 버전 차트 설치
- `helm upgrade [릴리스명] [차트명]`: 릴리스 업그레이드
- `helm list`: 모든 릴리스 목록 조회
- `helm history [릴리스명]`: 릴리스 이력 조회
- `helm rollback [릴리스명] [리비전번호]`: 특정 리비전으로 롤백

Helm의 라이프사이클 관리 기능을 통해 쿠버네티스 애플리케이션을 쉽게 관리하고 이전 상태로 복원할 수 있습니다. 이는 복잡한 구성 변경을 간소화하고 버전 간 이동을 용이하게 합니다.