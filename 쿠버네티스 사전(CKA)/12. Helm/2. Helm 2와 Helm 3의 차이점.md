## Helm의 역사적 배경

- **Helm 1.0**: 2016년 2월 출시
- **Helm 2.0**: 2016년 11월 출시
- **Helm 3.0**: 2019년 11월 출시
- 쿠버네티스 자체의 발전에 따라 Helm도 함께 발전
- 현재 권장되는 버전은 더 단순하고 개선된 설계의 Helm 3

## Helm 2와 Helm 3의 주요 차이점

### 1. Tiller 제거

**Helm 2 구조**:

- Helm 클라이언트와 쿠버네티스 사이에 Tiller라는 미들웨어 컴포넌트 필요
- **작동 방식**:
    - Helm 클라이언트 → Tiller → 쿠버네티스
    - Tiller가 중간자 역할 수행

**Tiller의 문제점**:

- 추가적인 복잡성 발생
- 보안 우려: "God 모드" 권한으로 실행
- 모든 사용자가 클러스터에서 무제한 액세스 가능

**Helm 3 구조**:

- Tiller 완전 제거
- Helm 클라이언트가 직접 쿠버네티스와 통신
- RBAC(Role-Based Access Control)와 CRD(Custom Resource Definitions) 활용
- 보안 강화: 쿠버네티스의 권한 관리 시스템 사용
- 사용자의 권한이 kubectl과 Helm 모두에서 일관되게 적용

### 2. 3-Way Strategic Merge Patch

**Helm 2의 리비전 관리**:

- 설치/업그레이드 시 리비전(스냅샷) 생성
- 롤백 시 **두 개의 정보만 비교**:
    - 현재 차트
    - 이전 차트
- **한계**:
    - kubectl 같은 외부 도구로 변경한 경우 감지 불가
    - 차트 자체 변경이 없으면 롤백 작동 안 함

**문제 시나리오 예시**:

1. Helm으로 WordPress(이미지 4.8) 설치 → 리비전 1 생성
2. kubectl로 수동 업데이트(이미지 5.8) → Helm 리비전 변경 없음
3. Helm 2로 롤백 시도 → 차트 간 차이 없음 → 변경 사항 없음
4. 수동 변경한 이미지 5.8 계속 유지됨

**Helm 3의 개선된 리비전 관리**:

- **3-Way 비교 방식** 사용:
    1. 현재 사용 중인 차트
    2. 돌아가려는 차트
    3. 실제 쿠버네티스 오브젝트의 라이브 상태
- **장점**:
    - 외부 도구로 변경한 사항도 감지 가능
    - 더 정확한 롤백 수행
    - 사용자 추가 변경사항 보존 가능

**업그레이드 개선**:

- Helm 2: 이전 차트와 새 차트만 비교 → 수동 변경 사항 손실
- Helm 3: 라이브 상태도 함께 비교 → 사용자 추가 변경사항 보존

## 리비전(Revision) 관리 방식

- **리비전 생성 시점**:
    - 초기 차트 설치: 리비전 1
    - 차트 업그레이드: 리비전 2
    - 롤백 수행: 리비전 3
- 모든 중요 변경사항은 새로운 리비전 생성
- Helm 3는 리비전 간 전환 시 더 지능적으로 변경 사항 관리

## 요약

1. **아키텍처 변화**: Tiller 제거로 단순화 및 보안 강화
2. **롤백 메커니즘 개선**: 3-Way Strategic Merge Patch로 정확성 향상
3. **사용자 변경사항 보존**: 수동 변경사항도 인식하고 보존
4. **보안 모델 향상**: 쿠버네티스 RBAC와 통합된 권한 관리

---

## 추가 참고사항

Helm 3는 쿠버네티스의 발전을 활용하여 더 단순하고 안전한 아키텍처를 제공합니다. 특히 3-Way Strategic Merge Patch는 복잡한 이름과 달리 실제로는 간단하지만 매우 유용한 기능으로, 실제 환경에서의 Helm 사용성을 크게 향상시켰습니다. 온라인 자료나 차트를 사용할 때 어떤 Helm 버전을 기준으로 작성되었는지 확인하는 것이 중요합니다.