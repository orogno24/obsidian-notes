## ğŸ”§ Sidecar Container

### ì •ì˜

**Sidecar Container**ëŠ” ë™ì¼í•œ Pod ë‚´ì—ì„œ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆì™€ í•¨ê»˜ ì‹¤í–‰ë˜ëŠ” ë³´ì¡° ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤. ì£¼ìš” ëª©ì ì€ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ê¸°ëŠ¥ì„ í–¥ìƒì‹œí‚¤ê±°ë‚˜ í™•ì¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

### ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€

- ë¡œê¹… (Logging)
- ëª¨ë‹ˆí„°ë§ (Monitoring)
- í”„ë¡ì‹œ (Proxying)
- ë°ì´í„° ë™ê¸°í™” (Data Synchronization)

### Kubernetes v1.29ë¶€í„°ì˜ ë³€í™”

**Kubernetes v1.29ë¶€í„°** Sidecar ContainerëŠ” `restartPolicy: Always`ë¥¼ ì„¤ì •í•œ **ì¬ì‹œì‘ ê°€ëŠ¥í•œ Init Container**ë¡œ êµ¬í˜„ë˜ë©°, `initContainers` í•„ë“œì— ë°°ì¹˜ë©ë‹ˆë‹¤.

**ì¥ì :**

- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆë³´ë‹¤ ë¨¼ì € ì‹œì‘
- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œëœ í›„ ë§ˆì§€ë§‰ì— ì¢…ë£Œ
- Pod ìƒëª…ì£¼ê¸° ë™ì•ˆ ê³„ì† ì‹¤í–‰
- ì˜ˆê¸°ì¹˜ ì•Šê²Œ ì¢…ë£Œë  ê²½ìš° ë…ë¦½ì ìœ¼ë¡œ ì¬ì‹œì‘ ê°€ëŠ¥

### ì˜ˆì‹œ: ë¡œê¹… Sidecarê°€ ìˆëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-with-logging-sidecar
spec:
  volumes:
    - name: shared-logs
      emptyDir: {}
  initContainers:
    - name: log-shipper
      image: alpine:latest
      command: ['sh', '-c', 'tail -F /opt/logs.txt']
      volumeMounts:
        - name: shared-logs
          mountPath: /opt
      restartPolicy: Always  # í•µì‹¬: Sidecar ì„¤ì •
  containers:
    - name: main-app
      image: alpine:latest
      command: ['sh', '-c', 'while true; do echo "logging" >> /opt/logs.txt; sleep 1; done']
      volumeMounts:
        - name: shared-logs
          mountPath: /opt
```

---

## ğŸ¤ Co-located Container

### ì •ì˜

**Co-located Container**ëŠ” ê³µí†µ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ í˜‘ì—…í•˜ëŠ” ë™ì¼í•œ Pod ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ëŠ” Kubernetes v1.29 ì—…ë°ì´íŠ¸ ì´ì „ì— "sidecar"ë¼ê³  ë¶ˆë ¸ë˜ ê²ƒì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ìƒˆë¡œìš´ ìš©ì–´ì…ë‹ˆë‹¤.

### íŠ¹ì§•

- ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ëŠ¥ì—ì„œ ë™ë“±í•œ ì±…ì„ ê³µìœ 
- ë…ë¦½ì ìœ¼ë¡œ ì‹œì‘ ë° ì¤‘ì§€ ê°€ëŠ¥
- ì •ì˜ëœ ì‹œì‘ ìˆœì„œ ì—†ìŒ

### ì˜ˆì‹œ: ì½˜í…ì¸  ìƒì„±ê¸°ê°€ ìˆëŠ” ì›¹ ì„œë²„

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: web-server-with-helper
spec:
  volumes:
    - name: shared-content
      emptyDir: {}
  containers:
    - name: content-generator
      image: busybox
      command: ['sh', '-c', 'echo "Hello from Helper!" > /output/index.html && sleep 3600']
      volumeMounts:
        - name: shared-content
          mountPath: /output
    - name: web-server
      image: nginx
      volumeMounts:
        - name: shared-content
          mountPath: /usr/share/nginx/html
```

---

## ğŸ“Š ì£¼ìš” ì°¨ì´ì  ë¹„êµ

|íŠ¹ì§•|Sidecar Container|Co-located Container|
|---|---|---|
|**ì£¼ìš” ì—­í• **|ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ê¸°ëŠ¥ í–¥ìƒ/í™•ì¥|ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì—ì„œ ë™ë“±í•˜ê²Œ í˜‘ì—…|
|**ì‹œì‘ ìˆœì„œ**|ë©”ì¸ ì»¨í…Œì´ë„ˆë³´ë‹¤ ë¨¼ì € ì‹œì‘ (initContainers ì‚¬ìš©)|ì •ì˜ëœ ì‹œì‘ ìˆœì„œ ì—†ìŒ|
|**ìƒëª…ì£¼ê¸°**|ë©”ì¸ ì»¨í…Œì´ë„ˆì™€ í•¨ê»˜ ì‹¤í–‰; ë…ë¦½ì  ì¬ì‹œì‘ ê°€ëŠ¥|ë…ë¦½ì ì¸ ìƒëª…ì£¼ê¸°|
|**ì¼ë°˜ì  ì‚¬ìš© ì‚¬ë¡€**|ë¡œê¹…, ëª¨ë‹ˆí„°ë§, í”„ë¡ì‹œ, ë°ì´í„° ë™ê¸°í™”|ë‹¤ì¤‘ í”„ë¡œì„¸ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜, í—¬í¼|
|**êµ¬í˜„ ë°©ì‹ (v1.29+)**|`initContainer`ì— `restartPolicy: Always` ì„¤ì •|`containers` í•„ë“œì— ì •ì˜|

---

## ğŸ’¡ ê²°ë¡ 

Sidecarì™€ Co-located Containerì˜ ì°¨ì´ì ì„ ì´í•´í•˜ëŠ” ê²ƒì€ íš¨ê³¼ì ì¸ ì¿ ë²„ë„¤í‹°ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ê³„ì— ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤.

**Kubernetes v1.29ì—ì„œ ë„¤ì´í‹°ë¸Œ Sidecar ì§€ì›ì´ ë„ì…**ë˜ë©´ì„œ Sidecar Container êµ¬í˜„ì´ ë”ìš± ê°„ì†Œí™”ë˜ì—ˆê³ , ì‹œì‘ ìˆœì„œì™€ ìƒëª…ì£¼ê¸° ê´€ë¦¬ì— ëŒ€í•œ ë” ë‚˜ì€ ì œì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

**ì ì ˆí•œ íŒ¨í„´ ì„ íƒ**ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì²´ì ì¸ ìš”êµ¬ ì‚¬í•­ê³¼ ì•„í‚¤í…ì²˜ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.

ë” ìì„¸í•œ ì •ë³´ëŠ” [ê³µì‹ ì¿ ë²„ë„¤í‹°ìŠ¤ Sidecar Container ë¬¸ì„œ](https://kubernetes.io/docs/concepts/workloads/pods/sidecar-containers/)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.












![[Pasted image 20250523093719.png]]

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mc-pod
  namespace: mc-namespace
  labels:
    run: mc-pod
spec:
  volumes:
    - name: data
      emptyDir: {}
  containers:
    - name: mc-pod-1
      image: nginx:1-alpine
      env:
        - name: NODE_NAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
    - name: mc-pod-2
      image: busybox:1
      command: ["sh", "-c", "while true; do date >> /var/log/shared/date.log; sleep 1; done"]
      volumeMounts:
        - name: data
          mountPath: /var/log/shared
    - name: mc-pod-3
      image: busybox:1
      command: ["sh", "-c", "tail -F /var/log/shared/date.log"]
      volumeMounts:
        - name: data
          mountPath: /var/log/shared
  dnsPolicy: ClusterFirst
  restartPolicy: Always
```

**ğŸ”¹ ì»¨í…Œì´ë„ˆë“¤ì˜ ê´€ì :**

|ë³¼ë¥¨ íƒ€ì…|ë²”ìœ„|ìƒëª…ì£¼ê¸°|
|---|---|---|
|`emptyDir`|Pod ë‚´ë¶€|Podì™€ ë™ì¼|
|`hostPath`|ë…¸ë“œ ì „ì²´|ë…¸ë“œì™€ ë™ì¼|
|`persistentVolume`|í´ëŸ¬ìŠ¤í„° ì „ì²´|ë…ë¦½ì |
## í™•ì¸ ë°©ë²•

- **emptyDir ë³¼ë¥¨ì˜ ë£¨íŠ¸**ë¥¼ ì»¨í…Œì´ë„ˆì˜ `/var/log/shared`ì— **ì—°ê²°**
- ì»¨í…Œì´ë„ˆëŠ” ì‹¤ì œë¡œëŠ” ë…¸ë“œì˜ emptyDirì„ ë³´ê³  ìˆëŠ” ê²ƒ
- `mc-pod-2`: ìì‹ ì˜ `/var/log/shared/date.log`ì— ì“°ê¸° â†’ ì‹¤ì œë¡œëŠ” ë…¸ë“œì˜ íŒŒì¼ì— ì“°ê¸°
- `mc-pod-3`: ìì‹ ì˜ `/var/log/shared/date.log`ì—ì„œ ì½ê¸° â†’ ì‹¤ì œë¡œëŠ” ê°™ì€ ë…¸ë“œ íŒŒì¼ì—ì„œ ì½ê¸°
- `emptyDir: {}`íŒŒë“œ ë°”ê¹¥(ë…¸ë“œ ë””ìŠ¤í¬)ì— ìˆì§€ë§Œ, **íŒŒë“œì™€ ìƒëª…ì£¼ê¸°ê°€ ë™ì¼**

```yaml
volumes:                    # ğŸ“¦ ì°½ê³  ë§Œë“¤ê¸° (íŒŒë“œ ë°”ê¹¥, ë…¸ë“œì—)
  - name: data             # ì°½ê³  ì´ë¦„í‘œ: "data"
    emptyDir: {}           # ë¹ˆ ì°½ê³  í•˜ë‚˜ ë§Œë“¤ì–´ì¤˜

volumeMounts:              # ğŸ”‘ ì°½ê³  ì ‘ê·¼ ì—´ì‡  ë§Œë“¤ê¸°
  - name: data             # "data" ì°½ê³ ì— ì ‘ê·¼í•˜ê³  ì‹¶ì–´
    mountPath: /var/log/shared  # ë‚´ ë°© ì•ˆì˜ "/var/log/shared" ë¬¸ìœ¼ë¡œ ì—°ê²°í•´ì¤˜
```