### 다중 환경 구성 관리의 어려움

- 하나의 애플리케이션을 여러 환경(개발, 스테이징, 프로덕션)에 배포할 때의 문제
- 각 환경마다 다른 구성이 필요함 (예: 복제본 수)
    - 개발(Development): 1개 복제본 (로컬 머신의 제한된 리소스)
    - 스테이징(Staging): 2-3개 복제본
    - 프로덕션(Production): 5-10개 복제본

### 일반적인 접근 방식의 한계

- **폴더 중복 방식**: 각 환경별로 별도 디렉토리 생성
    
    ```
    /dev/deployment.yaml    # replicas: 1
    /staging/deployment.yaml # replicas: 2
    /production/deployment.yaml # replicas: 5
    ```
    
- **이 방식의 문제점**:
    
    - 파일 중복: 모든 구성 파일이 여러 디렉토리에 복사됨
    - 유지보수 어려움: 변경사항을 모든 환경에 적용해야 함
    - 오류 가능성: 한 환경에서의 변경을 다른 환경에 적용하지 않을 위험
    - 확장성 부족: 리소스가 늘어날수록 관리 복잡도 증가
    - 일관성 유지 어려움: 환경 간 구성 불일치 발생 위험

## Kustomize의 접근 방식

### 핵심 개념

1. **Base(기본 구성)**
    - 모든 환경에서 동일하게 사용될 기본 구성
    - 기본값 정의 (예: replicas: 1)
    - 공통 리소스와 설정 포함
    
2. **Overlays(오버레이)**
    - 각 환경별 커스터마이징
    - Base에서 변경하려는 값만 지정
    - 환경별 고유 리소스 추가 가능

### 폴더 구조

```
/
├── base/               # 기본 구성
│   ├── deployment.yaml # replicas: 1 (기본값)
│   └── kustomization.yaml
│
└── overlays/           # 환경별 오버레이
    ├── development/    # 개발 환경 (기본값 사용)
    │   └── kustomization.yaml
    ├── staging/        # 스테이징 환경
    │   ├── kustomization.yaml
    │   └── replica-patch.yaml # replicas: 2
    └── production/     # 프로덕션 환경
        ├── kustomization.yaml
        └── replica-patch.yaml # replicas: 5
```

### 작동 방식

- Base 구성 + 환경별 Overlay = 최종 쿠버네티스 매니페스트
- kubectl이 내장 Kustomize를 사용해 최종 매니페스트 생성
- 매니페스트를 클러스터에 적용

## Kustomize의 장점

### 1. 간편한 사용

- kubectl에 내장되어 있어 별도 설치 불필요
    - 최신 기능 사용 시 별도 설치 가능

### 2. 템플릿 언어 불필요

- Helm과 달리 복잡한 템플릿 언어 학습 필요 없음
- 표준 YAML 파일만 사용
- 읽기 쉽고 이해하기 쉬운 구성

### 3. 유연성과 확장성

- 필요한 부분만 변경하여 중복 최소화
- 환경별 특정 리소스 추가 가능
- 코드 중복 없이 여러 환경 관리 가능

### 4. 순수 YAML 사용

- 특별한 문법이나 템플릿 언어가 없음
- 표준 YAML 검증 도구로 검증 가능
- 간단함을 강조하는 철학

## 요약

Kustomize는 쿠버네티스 구성 관리를 위한 도구로, 다양한 환경에서 리소스 구성을 효율적으로 관리하는 문제를 해결합니다. 기본 구성(Base)과 오버레이(Overlays)라는 간단한 개념을 사용하여 코드 중복 없이 환경별 맞춤 설정을 가능하게 합니다. 표준 YAML을 사용하고 복잡한 템플릿 언어를 피하는 간소한 접근 방식을 제공하여, 쿠버네티스 애플리케이션 관리를 단순화합니다.