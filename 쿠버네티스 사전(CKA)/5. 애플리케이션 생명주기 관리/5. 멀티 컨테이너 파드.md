### 멀티 컨테이너 파드 개념

멀티 컨테이너 파드는 하나의 파드 내에 여러 컨테이너를 함께 실행하는 패턴으로, 긴밀한 협력이 필요한 컨테이너들을 그룹화합니다.

**마이크로서비스 아키텍처에서의 활용**:

- 대규모 모놀리식 애플리케이션을 작은 독립적인 마이크로서비스로 분리
- 각 서비스를 독립적으로 개발, 배포 및 확장 가능
- 특정 상황에서는 두 서비스가 함께 작동해야 하는 경우 존재 (예: 웹 서버와 로깅 서비스)

### 멀티 컨테이너 파드의 특징

1. **생명주기 공유**:
    - 모든 컨테이너가 함께 생성되고 함께 종료됨
    - 하나의 컨테이너가 실패하면 전체 파드가 재시작
    
2. **네트워크 공유**:
    - 같은 파드 내 컨테이너들은 같은 네트워크 네임스페이스 공유
    - `localhost`를 통해 서로 통신 가능
    - 포트 충돌 주의 필요

3. **스토리지 공유**:
    - 파드 레벨에서 정의된 볼륨에 모든 컨테이너가 접근 가능
    - 컨테이너 간 데이터 공유 용이
    
4. **확장성**:
    - 파드 단위로 확장되므로 관련 컨테이너 그룹이 함께 스케일링

### 멀티 컨테이너 파드 패턴

1. **사이드카 패턴**:
    - 주 컨테이너의 기능을 확장하는 보조 컨테이너
    - 예: 로그 수집기, 파일 동기화, 프록시
    
2. **앰배서더 패턴**:
    - 주 컨테이너의 네트워크 연결을 대신 처리
    - 예: 데이터베이스 프록시, 서비스 메시 사이드카
    
3. **어댑터 패턴**:
    - 주 컨테이너의 출력을 표준화하거나 변환
    - 예: 모니터링 데이터 변환, 레거시 애플리케이션 API 변환

### 멀티 컨테이너 파드 정의

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: web-app
  labels:
    app: web-app
spec:
  containers:
  - name: web-server           # 주 컨테이너
    image: nginx
    ports:
    - containerPort: 80
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log/nginx
      
  - name: log-agent            # 사이드카 컨테이너
    image: log-agent
    volumeMounts:
    - name: shared-logs
      mountPath: /var/log
      readOnly: true
      
  volumes:
  - name: shared-logs          # 공유 볼륨
    emptyDir: {}
```

> 💡 **핵심**: `spec.containers` 섹션은 배열이므로 여러 컨테이너를 정의할 수 있습니다.

### 멀티 컨테이너 파드 활용 사례

1. **로깅 및 모니터링**:
    - 주 애플리케이션 + 로그 수집 에이전트
    - 예: 웹 서버 + Fluentd/Filebeat
    
2. **프록시 및 어댑터**:
    - 주 애플리케이션 + API 프록시
    - 예: 레거시 앱 + 현대적 API 어댑터
    
3. **초기화 및 설정**:
    - 초기화 컨테이너 + 주 애플리케이션
    - 예: 설정 로더 + 웹 애플리케이션
    
4. **백업 및 동기화**:
    - 주 애플리케이션 + 데이터 백업/동기화 컨테이너
    - 예: 데이터베이스 + 자동 백업 에이전트

### 멀티 컨테이너 파드 디버깅

```bash
# 특정 컨테이너의 로그 확인
kubectl logs <pod-name> -c <container-name>

# 특정 컨테이너에 명령 실행
kubectl exec <pod-name> -c <container-name> -- <command>

# 특정 컨테이너에 대화형 셸 접속
kubectl exec -it <pod-name> -c <container-name> -- /bin/sh
```

### 멀티 컨테이너 파드 설계 시 고려사항

1. **적절한 분리**: 컨테이너가 정말 같은 생명주기를 가져야 하는지 검토
2. **리소스 관리**: 각 컨테이너별로 리소스 요청 및 제한 설정
3. **상태 확인**: 각 컨테이너별로 적절한 liveness/readiness 프로브 설정
4. **로깅**: 각 컨테이너의 로그를 명확히 구분하여 관리
5. **보안**: 컨테이너 간 적절한 권한 분리