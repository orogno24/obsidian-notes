
## 1. ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì‚¬ìš©ì ìœ í˜•

1. **ê´€ë¦¬ì(Administrators)**
    - í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ì‘ì—… ìˆ˜í–‰
    - ë…¸ë“œ ê´€ë¦¬, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ êµ¬ì„±, ë¦¬ì†ŒìŠ¤ í• ë‹¹ ë“±
    
2. **ê°œë°œì(Developers)**
    - ì• í”Œë¦¬ì¼€ì´ì…˜ í…ŒìŠ¤íŠ¸ ë° ë°°í¬
    - íŒŒë“œ, ì„œë¹„ìŠ¤, ë°°í¬ ë“± ê´€ë¦¬
    
3. **ìµœì¢… ì‚¬ìš©ì(End Users)**
    - í´ëŸ¬ìŠ¤í„°ì— ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ì ‘ê·¼
    - í´ëŸ¬ìŠ¤í„° ì§ì ‘ ì ‘ê·¼ ì—†ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš©
    - **ì°¸ê³ **: ì´ë“¤ì˜ ì¸ì¦ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ì—ì„œ ê´€ë¦¬ë˜ë¯€ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ ì¸ì¦ ë²”ìœ„ì—ì„œ ì œì™¸
    
4. **ì„œë¹„ìŠ¤ ê³„ì •(Service Accounts)**
    - í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜
    - ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ í´ëŸ¬ìŠ¤í„° ê°„ í†µí•©

> ğŸ’¡ **ì¤‘ìš”**: ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì¸ì¦ì´ í•„ìš”í•œ ì£¼ì²´ëŠ” ì¸ê°„ ì‚¬ìš©ì(ê´€ë¦¬ì, ê°œë°œì)ì™€ ì‹œìŠ¤í…œ/ì„œë¹„ìŠ¤(ì„œë¹„ìŠ¤ ê³„ì •)ì…ë‹ˆë‹¤.

## 2. ì¿ ë²„ë„¤í‹°ìŠ¤ ì‚¬ìš©ì ê´€ë¦¬

ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” **ì‚¬ìš©ì ê³„ì •ì„ ì§ì ‘ ê´€ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ëŒ€ì‹  ì™¸ë¶€ ì†ŒìŠ¤ì— ì˜ì¡´í•©ë‹ˆë‹¤:

### ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ ë°©ì‹

- ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì‚¬ìš©ì ìƒì„±, ì¡°íšŒ, ì‚­ì œ ëª…ë ¹ì„ ì œê³µí•˜ì§€ ì•ŠìŒ
- ì‚¬ìš©ì ì •ë³´ëŠ” ì™¸ë¶€ì—ì„œ ê´€ë¦¬:
    - ì‚¬ìš©ì ì •ë³´ê°€ ë‹´ê¸´ íŒŒì¼(CSV ë“±)
    - ì¸ì¦ì„œ(Certificates)
    - ì™¸ë¶€ ID ì„œë¹„ìŠ¤(LDAP, Kerberos ë“±)

### ì„œë¹„ìŠ¤ ê³„ì • ê´€ë¦¬

- ì„œë¹„ìŠ¤ ê³„ì •ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ APIë¥¼ í†µí•´ ì§ì ‘ ê´€ë¦¬ ê°€ëŠ¥
- ìƒì„±, ì¡°íšŒ, ì‚­ì œ ê°€ëŠ¥í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¡œ ì·¨ê¸‰

```bash
# ì„œë¹„ìŠ¤ ê³„ì • ìƒì„±
kubectl create serviceaccount my-service-account

# ì„œë¹„ìŠ¤ ê³„ì • ì¡°íšŒ
kubectl get serviceaccounts
```

## 3. API ì„œë²„ ì¸ì¦ í”„ë¡œì„¸ìŠ¤

ëª¨ë“  ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ì€ kube-apiserverë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤:

### ì¸ì¦ íë¦„

1. ì‚¬ìš©ì/ì„œë¹„ìŠ¤ê°€ kubectl ë˜ëŠ” ì§ì ‘ API í˜¸ì¶œë¡œ ìš”ì²­
2. kube-apiserverê°€ ìš”ì²­ ìˆ˜ì‹ 
3. êµ¬ì„±ëœ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ì— ë”°ë¼ ìš”ì²­ì„ ì¸ì¦
4. ì¸ì¦ ì„±ê³µ í›„ ê¶Œí•œ ë¶€ì—¬(Authorization) ë‹¨ê³„ë¡œ ì§„í–‰

## 4. ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜

ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì—¬ëŸ¬ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ì„ ì§€ì›í•©ë‹ˆë‹¤:

### 4.1 ì •ì  ë¹„ë°€ë²ˆí˜¸ íŒŒì¼

ê°€ì¥ ë‹¨ìˆœí•œ ì¸ì¦ ë°©ì‹ìœ¼ë¡œ, CSV íŒŒì¼ì— ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤:

```csv
password123,user1,1001,group1
password456,user2,1002,group2
```

**ì„¤ì • ë°©ë²•**:

1. CSV íŒŒì¼ ìƒì„± (ì»¬ëŸ¼: ë¹„ë°€ë²ˆí˜¸, ì‚¬ìš©ìëª…, UID, ê·¸ë£¹(ì„ íƒì‚¬í•­))
2. kube-apiserverì— íŒŒì¼ ê²½ë¡œ ì „ë‹¬:

```bash
kube-apiserver --basic-auth-file=/path/to/password/file ...
```

**ì¸ì¦ ë°©ë²•**:

```bash
curl -u user1:password123 https://kube-api-server:6443/
```

### 4.2 ì •ì  í† í° íŒŒì¼

í† í° ê¸°ë°˜ ì¸ì¦ì„ ìœ„í•œ CSV íŒŒì¼:

```csv
token1,user1,1001,group1
token2,user2,1002,group2
```

**ì„¤ì • ë°©ë²•**:

```bash
kube-apiserver --token-auth-file=/path/to/token/file ...
```

**ì¸ì¦ ë°©ë²•**:

```bash
curl -H "Authorization: Bearer token1" https://kube-api-server:6443/
```

### 4.3 ì¸ì¦ì„œ ê¸°ë°˜ ì¸ì¦

TLS í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œë¥¼ ì‚¬ìš©í•œ ë” ì•ˆì „í•œ ì¸ì¦ ë°©ì‹:

1. ì‚¬ìš©ìë³„ ì¸ì¦ì„œ ìƒì„±
2. ì¸ì¦ì„œì— ì‚¬ìš©ì ì •ë³´ í¬í•¨
3. kube-apiserverê°€ ì¸ì¦ì„œë¥¼ ê²€ì¦í•˜ì—¬ ì¸ì¦

**ì¸ì¦ ë°©ë²•**:

```bash
kubectl --client-certificate=/path/to/cert.crt --client-key=/path/to/key.key get pods
```

### 4.4 ì„œë¹„ìŠ¤ ê³„ì • í† í°

íŒŒë“œ ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ ì¸ì¦ ë°©ì‹:

1. ì„œë¹„ìŠ¤ ê³„ì • ìƒì„±
2. í† í°ì´ ìë™ ìƒì„±ë˜ì–´ ì‹œí¬ë¦¿ì— ì €ì¥
3. íŒŒë“œì— ë³¼ë¥¨ìœ¼ë¡œ ë§ˆìš´íŠ¸í•˜ì—¬ ì‚¬ìš©

### 4.5 OpenID Connect(OIDC)

ì™¸ë¶€ OAuth2 ê³µê¸‰ìë¥¼ í†µí•œ ì¸ì¦:

1. ì‚¬ìš©ìê°€ ì™¸ë¶€ ID ê³µê¸‰ì(Google, GitHub ë“±)ì— ë¡œê·¸ì¸
2. ID ê³µê¸‰ìê°€ JWT í† í° ë°œê¸‰
3. í† í°ì„ kubectlì— ì œê³µí•˜ì—¬ ì¸ì¦

### 4.6 ì›¹í›… í† í° ì¸ì¦

ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ì—¬ í† í° ê²€ì¦:

1. ì‚¬ìš©ìê°€ í† í° ì œê³µ
2. kube-apiserverê°€ ì™¸ë¶€ ì„œë¹„ìŠ¤ì— í† í° ê²€ì¦ ìš”ì²­
3. ì™¸ë¶€ ì„œë¹„ìŠ¤ê°€ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜

## 5. kubeadm í™˜ê²½ì—ì„œì˜ ì¸ì¦ ì„¤ì •

kubeadmìœ¼ë¡œ ì„¤ì¹˜ëœ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì¸ì¦ ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” ë°©ë²•:

### 5.1 ì •ì  íŒŒì¼ ì¸ì¦ ì„¤ì •

1. kube-apiserver íŒŒë“œ ì •ì˜ íŒŒì¼ ì°¾ê¸°:

```bash
ls /etc/kubernetes/manifests/kube-apiserver.yaml
```

2. kube-apiserver íŒŒë“œ ì •ì˜ ìˆ˜ì •:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: kube-apiserver
  namespace: kube-system
spec:
  containers:
  - command:
    - kube-apiserver
    - --basic-auth-file=/etc/kubernetes/auth/basic-auth.csv
    # ë‹¤ë¥¸ ì˜µì…˜ë“¤...
    volumeMounts:
    - mountPath: /etc/kubernetes/auth
      name: auth-files
      readOnly: true
    # ë‹¤ë¥¸ ë³¼ë¥¨ ë§ˆìš´íŠ¸...
  volumes:
  - hostPath:
      path: /etc/kubernetes/auth
      type: DirectoryOrCreate
    name: auth-files
  # ë‹¤ë¥¸ ë³¼ë¥¨...
```

3. í˜¸ìŠ¤íŠ¸ì— ì¸ì¦ íŒŒì¼ ìƒì„±:

```bash
mkdir -p /etc/kubernetes/auth
echo "password123,user1,1001,system:masters" > /etc/kubernetes/auth/basic-auth.csv
```

4. íŒŒì¼ ë³€ê²½ í›„ kube-apiserverëŠ” ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë¨

## 6. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 6.1 ì •ì  íŒŒì¼ ì¸ì¦ì˜ í•œê³„

- **ë³´ì•ˆ ìœ„í—˜**: ë¹„ë°€ë²ˆí˜¸ì™€ í† í°ì´ í‰ë¬¸ìœ¼ë¡œ ì €ì¥
- **ê´€ë¦¬ ì–´ë ¤ì›€**: ì‚¬ìš©ì ì¶”ê°€/ì œê±° ì‹œ íŒŒì¼ ìˆ˜ì • ë° API ì„œë²„ ì¬ì‹œì‘ í•„ìš”
- **í™•ì¥ì„± ë¶€ì¡±**: ëŒ€ê·œëª¨ í™˜ê²½ì— ì í•©í•˜ì§€ ì•ŠìŒ

> âš ï¸ **ì£¼ì˜**: ì •ì  íŒŒì¼ ê¸°ë°˜ ì¸ì¦ì€ í•™ìŠµ ëª©ì ì´ë‚˜ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ë§Œ ì‚¬ìš©í•˜ê³ , í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë” ì•ˆì „í•œ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜(ì¸ì¦ì„œ, OIDC ë“±)ì„ ì‚¬ìš©í•˜ì„¸ìš”.

### 6.2 ê¶Œì¥ë˜ëŠ” ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜

1. **í”„ë¡œë•ì…˜ í™˜ê²½**: ì¸ì¦ì„œ ê¸°ë°˜ ì¸ì¦ ë˜ëŠ” OIDC
2. **ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½**: ì¸ì¦ì„œ ë˜ëŠ” ì„œë¹„ìŠ¤ ê³„ì •
3. **CI/CD íŒŒì´í”„ë¼ì¸**: ì„œë¹„ìŠ¤ ê³„ì • ë˜ëŠ” ì¸ì¦ì„œ

## 7. ë‹¤ìŒ ë‹¨ê³„: ê¶Œí•œ ë¶€ì—¬(Authorization)

ì¸ì¦ í›„ì—ëŠ” ê¶Œí•œ ë¶€ì—¬(Authorization) ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤:

- ì¸ì¦ì€ "ëˆ„ê°€" í´ëŸ¬ìŠ¤í„°ì— ì ‘ê·¼í•˜ëŠ”ì§€ í™•ì¸
- ê¶Œí•œ ë¶€ì—¬ëŠ” ì¸ì¦ëœ ì‚¬ìš©ìê°€ "ë¬´ì—‡ì„" í•  ìˆ˜ ìˆëŠ”ì§€ ê²°ì •
- RBAC(Role-Based Access Control)ì´ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì£¼ìš” ê¶Œí•œ ë¶€ì—¬ ë©”ì»¤ë‹ˆì¦˜

## ìš”ì•½

- ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì‚¬ìš©ì ê³„ì •ì„ ì§ì ‘ ê´€ë¦¬í•˜ì§€ ì•Šê³  ì™¸ë¶€ ì†ŒìŠ¤ì— ì˜ì¡´
- ëª¨ë“  í´ëŸ¬ìŠ¤í„° ì ‘ê·¼ì€ kube-apiserverë¥¼ í†µí•´ ì¸ì¦
- ë‹¤ì–‘í•œ ì¸ì¦ ë©”ì»¤ë‹ˆì¦˜ ì§€ì›: ì •ì  íŒŒì¼, ì¸ì¦ì„œ, ì„œë¹„ìŠ¤ ê³„ì •, OIDC ë“±
- ì •ì  íŒŒì¼ ì¸ì¦ì€ ë³´ì•ˆìƒ ê¶Œì¥ë˜ì§€ ì•Šìœ¼ë©° í•™ìŠµ ìš©ë„ë¡œë§Œ ì‚¬ìš©
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì¸ì¦ì„œ ê¸°ë°˜ ì¸ì¦ì´ë‚˜ OIDCì™€ ê°™ì€ ì•ˆì „í•œ ë©”ì»¤ë‹ˆì¦˜ ì‚¬ìš© ê¶Œì¥
- ì¸ì¦ í›„ì—ëŠ” ì ì ˆí•œ ê¶Œí•œ ë¶€ì—¬ ì„¤ì • í•„ìš”


---

# Kubernetes Basic Authentication ì„¤ì • (í•™ìŠµìš©, deprecated)

> âš ï¸ **ì£¼ì˜**
> 
> - Basic Auth ë°©ì‹ì€ **Kubernetes v1.19ë¶€í„° deprecated**
> - **í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ ê²ƒ**
> - ì˜¤ì§ **ë¡œì»¬ í•™ìŠµìš©**ì´ë‚˜ í…ŒìŠ¤íŠ¸ í´ëŸ¬ìŠ¤í„°ì—ì„œë§Œ ì‚¬ìš©

## 1. ì‚¬ìš©ì ì •ë³´ CSV íŒŒì¼ ë§Œë“¤ê¸°

```bash
mkdir -p /tmp/users
vi /tmp/users/user-details.csv
```

```csv
password123,user1,u0001
password123,user2,u0002
password123,user3,u0003
password123,user4,u0004
password123,user5,u0005
```

- í¬ë§·: `ë¹„ë°€ë²ˆí˜¸, ì‚¬ìš©ìëª…, ì‚¬ìš©ìID`
- ì´ íŒŒì¼ì€ kube-apiserverê°€ ì½ì„ ìˆ˜ ìˆëŠ” ìœ„ì¹˜ì— ìˆì–´ì•¼ í•¨
## 2. kube-apiserver ìˆ˜ì •í•˜ê¸° (static pod)

`/etc/kubernetes/manifests/kube-apiserver.yaml` ì—´ì–´ì„œ ì•„ë˜ í•­ëª©ë“¤ ì¶”ê°€

### 2-1. **volumeMounts**ì™€ **volumes** ì¶”ê°€

```yaml
volumeMounts:
- mountPath: /tmp/users
  name: usr-details
  readOnly: true
```

```yaml
volumes:
- name: usr-details
  hostPath:
    path: /tmp/users
    type: DirectoryOrCreate
```

### 2-2. **command**ì— ì¸ì¦ íŒŒì¼ ê²½ë¡œ ì¶”ê°€

```yaml
- --basic-auth-file=/tmp/users/user-details.csv
```

ì˜ˆì‹œ:

```yaml
command:
- kube-apiserver
- --authorization-mode=Node,RBAC
- --basic-auth-file=/tmp/users/user-details.csv
```

ë³€ê²½ ì €ì¥í•˜ë©´ kubeletì´ ìë™ìœ¼ë¡œ static podë¥¼ ì¬ì‹œì‘í•¨.

## 3. RBAC ì„¤ì •: ìœ ì €ì—ê²Œ ê¶Œí•œ ë¶€ì—¬

### Role ìƒì„± (ì˜ˆ: íŒŒë“œ ì½ê¸° ê¶Œí•œ)

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: pod-reader
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "watch", "list"]
```

### RoleBindingìœ¼ë¡œ ìœ ì €ë‘ ì—°ê²°

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods
  namespace: default
subjects:
- kind: User
  name: user1   # user-details.csvì— ìˆëŠ” ì´ë¦„ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„)
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io
```

## 4. ì¸ì¦ í…ŒìŠ¤íŠ¸ (curl ì‚¬ìš©)

```bash
curl -v -k https://localhost:6443/api/v1/pods -u "user1:password123"
```

- `-k`: self-signed ì¸ì¦ì„œ í—ˆìš©
- `-u`: ê¸°ë³¸ ì¸ì¦ (username:password)

## ìš”ì•½

|ë‹¨ê³„|ì„¤ëª…|
|---|---|
|1|`/tmp/users/user-details.csv`ì— ì‚¬ìš©ì ëª©ë¡ ì €ì¥|
|2|`kube-apiserver.yaml` ìˆ˜ì •í•´ì„œ basic-auth íŒŒì¼ ë“±ë¡|
|3|Role, RoleBindingìœ¼ë¡œ ìœ ì € ê¶Œí•œ ë¶€ì—¬|
|4|curlë¡œ ì§ì ‘ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸|
