
## 1. ì¸ì¦ì„œ í™•ì¸ì˜ ì¤‘ìš”ì„±

ì¸ì¦ì„œëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ë³´ì•ˆì— í•µì‹¬ì ì¸ ì—­í• ì„ í•©ë‹ˆë‹¤. ìƒˆë¡œìš´ ê´€ë¦¬ìë¡œì„œ í´ëŸ¬ìŠ¤í„°ì˜ ì¸ì¦ì„œ ìƒíƒœë¥¼ ì ê²€í•˜ëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ë¡œ ì¤‘ìš”í•©ë‹ˆë‹¤:

- **ë³´ì•ˆ ì·¨ì•½ì  ì˜ˆë°©**: ë§Œë£Œë˜ê±°ë‚˜ ì˜ëª» êµ¬ì„±ëœ ì¸ì¦ì„œëŠ” ë³´ì•ˆ ìœ„í—˜ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ë‹¤ìš´íƒ€ì„ ë°©ì§€**: ì¸ì¦ì„œ ë§Œë£Œë¡œ ì¸í•œ ì˜ˆê¸°ì¹˜ ì•Šì€ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì„ ì˜ˆë°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ë¬¸ì œ í•´ê²°**: ì¸ì¦ì„œ ê´€ë ¨ ë¬¸ì œë¥¼ ë¹ ë¥´ê²Œ ì§„ë‹¨í•˜ê³  í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 2. í´ëŸ¬ìŠ¤í„° ì„¤ì • ë°©ì‹ íŒŒì•…

ì¸ì¦ì„œë¥¼ ê²€ì‚¬í•˜ê¸° ì „ì— í´ëŸ¬ìŠ¤í„°ê°€ ì–´ë–»ê²Œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ íŒŒì•…í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤:

### ì„¤ì • ë°©ë²•ì— ë”°ë¥¸ ì°¨ì´ì 

1. **ìˆ˜ë™ ì„¤ì¹˜ ë°©ì‹(Hard Way)**
    - ëª¨ë“  ì¸ì¦ì„œë¥¼ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ê³  êµ¬ì„±
    - ì»´í¬ë„ŒíŠ¸ê°€ ë„¤ì´í‹°ë¸Œ ì„œë¹„ìŠ¤ë¡œ ì‹¤í–‰ë¨
    - ì¸ì¦ì„œ íŒŒì¼ì€ ì§€ì •ëœ ê²½ë¡œì— ì§ì ‘ ì €ì¥ë¨
    
2. **kubeadm ë„êµ¬ ì‚¬ìš©**
    - ì¸ì¦ì„œê°€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ê³  êµ¬ì„±ë¨
    - ëŒ€ë¶€ë¶„ì˜ ì»´í¬ë„ŒíŠ¸ê°€ íŒŒë“œë¡œ ì‹¤í–‰ë¨
    - ì¸ì¦ì„œ íŒŒì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ `/etc/kubernetes/pki` ê²½ë¡œì— ì €ì¥ë¨
    
3. **ê´€ë¦¬í˜• ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤**
    - í´ë¼ìš°ë“œ ì œê³µì—…ì²´ê°€ ì¸ì¦ì„œ ê´€ë¦¬
    - ì¸ì¦ì„œì— ëŒ€í•œ ì œí•œëœ ì ‘ê·¼ ê°€ëŠ¥

> ğŸ“ **ì°¸ê³ **: ì´ ê°€ì´ë“œì—ì„œëŠ” ì£¼ë¡œ kubeadmìœ¼ë¡œ ì„¤ì •ëœ í´ëŸ¬ìŠ¤í„°ì— ì¤‘ì ì„ ë‘¡ë‹ˆë‹¤.

## 3. ì¸ì¦ì„œ ê±´ê°• ì ê²€ ë°©ë²•ë¡ 

### 3.1 ì¸ì¦ì„œ ì •ë³´ ìˆ˜ì§‘ ë° ì •ë¦¬

íš¨ê³¼ì ì¸ ì¸ì¦ì„œ ê²€ì‚¬ë¥¼ ìœ„í•´ ë‹¤ìŒ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ê³  ì •ë¦¬í•©ë‹ˆë‹¤:

|í•­ëª©|ì„¤ëª…|
|---|---|
|**ì¸ì¦ì„œ íŒŒì¼ ê²½ë¡œ**|ì¸ì¦ì„œ íŒŒì¼ì˜ ìœ„ì¹˜|
|**ì£¼ì²´ëª…(Subject)**|ì¸ì¦ì„œì— ì„¤ì •ëœ ì´ë¦„|
|**ëŒ€ì²´ ì´ë¦„(SAN)**|ì¶”ê°€ ë„ë©”ì¸/IP ì£¼ì†Œ|
|**ì¡°ì§(Organization)**|ì¸ì¦ì„œê°€ ì†í•œ ê·¸ë£¹|
|**ë°œê¸‰ì(Issuer)**|ì¸ì¦ì„œë¥¼ ì„œëª…í•œ CA|
|**ìœ íš¨ ê¸°ê°„**|ì¸ì¦ì„œ ë§Œë£Œ ë‚ ì§œ|

### 3.2 ì¸ì¦ì„œ íŒŒì¼ ìœ„ì¹˜ í™•ì¸

**kubeadmìœ¼ë¡œ ì„¤ì¹˜ëœ í´ëŸ¬ìŠ¤í„°**:

1. API ì„œë²„ ì •ì˜ íŒŒì¼ í™•ì¸:
    
    ```bash
    cat /etc/kubernetes/manifests/kube-apiserver.yaml
    ```
    
2. ì¸ì¦ì„œ ê´€ë ¨ ì˜µì…˜ ì°¾ê¸°:
    
    ```
    --client-ca-file=/etc/kubernetes/pki/ca.crt
    --tls-cert-file=/etc/kubernetes/pki/apiserver.crt
    --tls-private-key-file=/etc/kubernetes/pki/apiserver.key
    # ê¸°íƒ€ ë‹¤ë¥¸ ì¸ì¦ì„œ ì˜µì…˜ë“¤...
    ```
    
3. ì£¼ìš” ì¸ì¦ì„œ íŒŒì¼ ê²½ë¡œ:
    
    - `/etc/kubernetes/pki/ca.crt`: CA ì¸ì¦ì„œ
    - `/etc/kubernetes/pki/apiserver.crt`: API ì„œë²„ ì¸ì¦ì„œ
    - `/etc/kubernetes/pki/apiserver-kubelet-client.crt`: API ì„œë²„ì˜ kubelet í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œ
    - `/etc/kubernetes/pki/front-proxy-ca.crt`: í”„ë¡ íŠ¸ í”„ë¡ì‹œ CA ì¸ì¦ì„œ
    - `/etc/kubernetes/pki/etcd/ca.crt`: etcd CA ì¸ì¦ì„œ
    - `/etc/kubernetes/pki/etcd/server.crt`: etcd ì„œë²„ ì¸ì¦ì„œ

## 4. ì¸ì¦ì„œ ì„¸ë¶€ ì •ë³´ í™•ì¸

### 4.1 OpenSSLì„ ì‚¬ìš©í•œ ì¸ì¦ì„œ ê²€ì‚¬

```bash
openssl x509 -in /etc/kubernetes/pki/apiserver.crt -text -noout
```

ì´ ëª…ë ¹ì–´ëŠ” ì¸ì¦ì„œì˜ ëª¨ë“  ì„¸ë¶€ ì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤:

#### ì£¼ìš” í™•ì¸ í•­ëª©

1. **ì£¼ì²´ëª…(Subject)**:
    
    ```
    Subject: CN=kube-apiserver
    ```
    
2. **ëŒ€ì²´ ì´ë¦„(Subject Alternative Name)**:
    
    ```
    X509v3 Subject Alternative Name:
        DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, IP Address:10.96.0.1, IP Address:192.168.5.11
    ```
    
3. **ìœ íš¨ ê¸°ê°„**:
    
    ```
    Not Before: Jan 1 00:00:00 2023 GMT
    Not After : Dec 31 23:59:59 2023 GMT
    ```
    
4. **ë°œê¸‰ì(Issuer)**:
    
    ```
    Issuer: CN=kubernetes
    ```
    

### 4.2 kubectlì„ ì‚¬ìš©í•œ ì¸ì¦ì„œ ê²€ì‚¬

kubeadm í´ëŸ¬ìŠ¤í„°ì˜ ê²½ìš°, `kubeadm`ì´ ì¸ì¦ì„œ ê´€ë ¨ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

```bash
# ëª¨ë“  ì¸ì¦ì„œì˜ ë§Œë£Œ ì •ë³´ í™•ì¸
kubeadm certs check-expiration
```

ì¶œë ¥ ì˜ˆì‹œ:

```
CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED
admin.conf                 Dec 30, 2023 05:46 UTC   358d            ca                      no
apiserver                  Dec 30, 2023 05:46 UTC   358d            ca                      no
apiserver-kubelet-client   Dec 30, 2023 05:46 UTC   358d            ca                      no
controller-manager.conf    Dec 30, 2023 05:46 UTC   358d            ca                      no
...
```

## 5. ì¸ì¦ì„œ ë¬¸ì œ ì‹ë³„ ë° í•´ê²°

### 5.1 ì¼ë°˜ì ì¸ ì¸ì¦ì„œ ë¬¸ì œ

1. **ë§Œë£Œëœ ì¸ì¦ì„œ**:
    - ì¦ìƒ: ì»´í¬ë„ŒíŠ¸ ì—°ê²° ì‹¤íŒ¨, "certificate has expired" ì˜¤ë¥˜
    - í•´ê²°: ì¸ì¦ì„œ ê°±ì‹  (`kubeadm certs renew all`)

2. **ì˜ëª»ëœ ì£¼ì²´ëª… ë˜ëŠ” SAN**:
    - ì¦ìƒ: "x509: certificate is valid for ... not for ..." ì˜¤ë¥˜
    - í•´ê²°: ì˜¬ë°”ë¥¸ ì´ë¦„ìœ¼ë¡œ ì¸ì¦ì„œ ì¬ìƒì„±
    
3. **ì˜ëª»ëœ ê¶Œí•œ**:
    - ì¦ìƒ: ì»´í¬ë„ŒíŠ¸ê°€ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŒ
    - í•´ê²°: ì¸ì¦ì„œ íŒŒì¼ ê¶Œí•œ í™•ì¸ ë° ìˆ˜ì •
    
4. **CA ë¶ˆì¼ì¹˜**:
    - ì¦ìƒ: "x509: certificate signed by unknown authority" ì˜¤ë¥˜
    - í•´ê²°: ì˜¬ë°”ë¥¸ CAë¡œ ì¸ì¦ì„œ ì¬ì„œëª…

### 5.2 ë¡œê·¸ í™•ì¸ ë°©ë²•

#### ìˆ˜ë™ ì„¤ì¹˜ í´ëŸ¬ìŠ¤í„°ì˜ ë¡œê·¸ í™•ì¸

ì‹œìŠ¤í…œ ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸:

```bash
# journalctlì„ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œ
journalctl -u kube-apiserver

# systemdë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œ
systemctl status kube-apiserver
```

#### kubeadm í´ëŸ¬ìŠ¤í„°ì˜ ë¡œê·¸ í™•ì¸

íŒŒë“œë¡œ ì‹¤í–‰ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ë¡œê·¸:

```bash
# API ì„œë²„ ë¡œê·¸ í™•ì¸
kubectl logs -n kube-system kube-apiserver-<hostname>

# ETCD ë¡œê·¸ í™•ì¸
kubectl logs -n kube-system etcd-<hostname>
```

#### API ì„œë²„ê°€ ë‹¤ìš´ëœ ê²½ìš°ì˜ ë¡œê·¸ í™•ì¸

API ì„œë²„ê°€ ë‹¤ìš´ë˜ì–´ kubectlì´ ì‘ë™í•˜ì§€ ì•ŠëŠ” ê²½ìš°:

```bash
# ì»¨í…Œì´ë„ˆ ID í™•ì¸
docker ps -a | grep kube-apiserver

# ì»¨í…Œì´ë„ˆ ë¡œê·¸ í™•ì¸
docker logs <container-id>
```

> âš ï¸ **ì°¸ê³ **: ìµœì‹  ì¿ ë²„ë„¤í‹°ìŠ¤ ë²„ì „ì—ì„œëŠ” Docker ëŒ€ì‹  containerdë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì´ ê²½ìš° `crictl` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

## 6. ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸

í´ëŸ¬ìŠ¤í„°ì˜ ì¸ì¦ì„œë¥¼ ì •ê¸°ì ìœ¼ë¡œ ì ê²€í•˜ê¸° ìœ„í•œ ì²´í¬ë¦¬ìŠ¤íŠ¸:

### ê¸°ë³¸ ì¸ì¦ì„œ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

1. **ëª¨ë“  ì¸ì¦ì„œì˜ ë§Œë£Œ ë‚ ì§œ í™•ì¸**
    - ë§Œë£Œ 30ì¼ ì „ì— ê°±ì‹  ê³„íš ìˆ˜ë¦½
    
2. **kube-apiserver ì¸ì¦ì„œ SAN í™•ì¸**
    - ëª¨ë“  í•„ìˆ˜ DNS ì´ë¦„ ë° IP ì£¼ì†Œ í¬í•¨ ì—¬ë¶€
    
3. **kubelet í´ë¼ì´ì–¸íŠ¸ ì¸ì¦ì„œ í™•ì¸**
    - ì˜¬ë°”ë¥¸ `system:node:<nodeName>` í˜•ì‹ í™•ì¸
    - `system:nodes` ê·¸ë£¹ í¬í•¨ ì—¬ë¶€

4. **ê´€ë¦¬ì ì¸ì¦ì„œ í™•ì¸**
    - `system:masters` ê·¸ë£¹ í¬í•¨ ì—¬ë¶€
    
5. **CA ì¸ì¦ì„œ í™•ì¸**
    - ëª¨ë“  ì¸ì¦ì„œê°€ ì˜¬ë°”ë¥¸ CAì— ì˜í•´ ì„œëª…ë˜ì—ˆëŠ”ì§€ í™•ì¸

### ìë™í™”ëœ ëª¨ë‹ˆí„°ë§ ì„¤ì •

- ì¸ì¦ì„œ ë§Œë£Œ ì•Œë¦¼ ì„¤ì •
- ì •ê¸°ì ì¸ ì¸ì¦ì„œ ê±´ê°• ì ê²€ ìŠ¤í¬ë¦½íŠ¸ êµ¬í˜„
- ì¸ì¦ì„œ ê´€ë ¨ ì˜¤ë¥˜ì— ëŒ€í•œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§

## ìš”ì•½

- ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì˜ ì¸ì¦ì„œ ìƒíƒœë¥¼ ì •ê¸°ì ìœ¼ë¡œ ì ê²€í•˜ëŠ” ê²ƒì€ í´ëŸ¬ìŠ¤í„° ë³´ì•ˆê³¼ ì•ˆì •ì„±ì— ì¤‘ìš”í•©ë‹ˆë‹¤.
- ì¸ì¦ì„œ ê´€ë¦¬ ë°©ë²•ì€ í´ëŸ¬ìŠ¤í„° ì„¤ì • ë°©ì‹(ìˆ˜ë™, kubeadm, ê´€ë¦¬í˜•)ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.
- OpenSSLê³¼ kubeadm ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ì„œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì£¼ì²´ëª…, ëŒ€ì²´ ì´ë¦„, ì¡°ì§, ë°œê¸‰ì, ë§Œë£Œ ë‚ ì§œëŠ” ì¸ì¦ì„œ ì ê²€ ì‹œ í™•ì¸í•´ì•¼ í•  ì£¼ìš” í•­ëª©ì…ë‹ˆë‹¤.
- ì¸ì¦ì„œ ê´€ë ¨ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì—¬ ê·¼ë³¸ ì›ì¸ì„ íŒŒì•…í•˜ê³  í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì •ê¸°ì ì¸ ì¸ì¦ì„œ ì ê²€ê³¼ ë§Œë£Œ ì „ ê°±ì‹ ì„ í†µí•´ ì¸ì¦ì„œ ê´€ë ¨ ë¬¸ì œë¥¼ ì˜ˆë°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.