# Kubernetes RBAC (ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´) ì‹¤ì „ ì •ë¦¬

## 1. Role ë§Œë“¤ê¸°

**Role**ì€ íŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì•ˆì—ì„œ **ì–´ë–¤ ë¦¬ì†ŒìŠ¤ì— ì–´ë–¤ ë™ì‘ì„ í—ˆìš©í• ì§€** ì •ì˜í•˜ëŠ” ê°ì²´.

### ğŸ›  Role ì˜ˆì‹œ

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: developer
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "create", "delete"]
- apiGroups: [""]
  resources: ["configmaps"]
  verbs: ["create"]
```

- `apiGroups: [""]` â†’ core API ê·¸ë£¹ (ì˜ˆ: Pod, ConfigMap ë“±)
- `resources` â†’ ì ‘ê·¼ í—ˆìš©í•  ë¦¬ì†ŒìŠ¤
- `verbs` â†’ í—ˆìš©í•  ë™ì‘

> í•˜ë‚˜ì˜ Role ì•ˆì— ì—¬ëŸ¬ ruleì„ ì •ì˜í•  ìˆ˜ ìˆìŒ

### âœ… ìƒì„± ëª…ë ¹ì–´

```bash
kubectl create -f developer-role.yaml
```

---

## 2. RoleBinding ë§Œë“¤ê¸°

**RoleBinding**ì€ íŠ¹ì • **ì‚¬ìš©ì(subject)** ì—ê²Œ **Roleì„ ë¶€ì—¬**í•˜ëŠ” ê°ì²´.

### ğŸ›  RoleBinding ì˜ˆì‹œ

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: dev-user-binding
  namespace: default
subjects:
- kind: User
  name: dev-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: developer
  apiGroup: rbac.authorization.k8s.io
```

- `subjects`: ê¶Œí•œì„ ì¤„ ëŒ€ìƒ (User, Group, ServiceAccount ë“±)
- `roleRef`: ì–´ë–¤ Roleì„ ë¶€ì—¬í• ì§€

### âœ… ìƒì„± ëª…ë ¹ì–´

```bash
kubectl create -f dev-user-binding.yaml
```

---

## 3. ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë²”ìœ„

- Roleê³¼ RoleBindingì€ **ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‹¨ìœ„ë¡œ ë™ì‘í•¨**
- ë”°ë¼ì„œ `namespace: default`ë¡œ ì„¤ì •í•˜ë©´ í•´ë‹¹ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œë§Œ ê¶Œí•œ ì ìš©ë¨

---

## 4. ë¦¬ì†ŒìŠ¤ í™•ì¸ ëª…ë ¹ì–´

```bash
kubectl get roles -n default
kubectl get rolebindings -n default

kubectl describe role developer -n default
kubectl describe rolebinding dev-user-binding -n default
```

---

## 5. ì‚¬ìš©ì ê¶Œí•œ í™•ì¸

```bash
kubectl auth can-i create deployments
kubectl auth can-i delete nodes
kubectl auth can-i create deployments --as dev-user
kubectl auth can-i delete nodes --as dev-user
kubectl auth can-i create pods -n test --as dev-user
```

- `--as <user>`: ë‹¤ë¥¸ ì‚¬ìš©ìë¡œ ê°€ì¥í•´ì„œ í…ŒìŠ¤íŠ¸
- `--namespace` ë˜ëŠ” `-n`: ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì§€ì •

---

## 6. íŠ¹ì • ë¦¬ì†ŒìŠ¤ë§Œ í—ˆìš©í•˜ê¸° (resourceNames)

**ëª¨ë“  ë¦¬ì†ŒìŠ¤ê°€ ì•„ë‹Œ, íŠ¹ì • ì´ë¦„ì˜ ë¦¬ì†ŒìŠ¤ì—ë§Œ ì ‘ê·¼ í—ˆìš© ê°€ëŠ¥**

### ì˜ˆì‹œ: íŠ¹ì • íŒŒë“œë§Œ ì ‘ê·¼ í—ˆìš©

```yaml
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list"]
  resourceNames: ["blue-pod", "orange-pod"]
```

---

## âœ… ìš”ì•½

|ê°œë…|ì„¤ëª…|
|---|---|
|Role|ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì•ˆì—ì„œ ì–´ë–¤ ë¦¬ì†ŒìŠ¤ë¥¼ ì–´ë–»ê²Œ ì¡°ì‘í•  ìˆ˜ ìˆëŠ”ì§€ ì •ì˜|
|RoleBinding|íŠ¹ì • ì‚¬ìš©ìì—ê²Œ Role ê¶Œí•œì„ ë¶€ì—¬|
|apiGroups|core APIëŠ” `""`, ê·¸ ì™¸ì—ëŠ” groupëª… ì‚¬ìš©|
|verbs|`get`, `list`, `create`, `delete` ë“± í—ˆìš©í•  ë™ì‘ë“¤|
|resourceNames|íŠ¹ì • ë¦¬ì†ŒìŠ¤ ì´ë¦„ë§Œ ì§€ì •í•´ì„œ ì„¸ë¶€ ì œì–´ ê°€ëŠ¥|
|`kubectl auth can-i`|ê¶Œí•œ í™•ì¸ìš© í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´|

## ğŸ§± ê·¸ëŸ¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë°”ê¹¥ ë¦¬ì†ŒìŠ¤ëŠ”?

![[Pasted image 20250515174633.png]]
### ì˜ˆ: Node, PersistentVolume, CertificateSigningRequest

- ì´ëŸ° ë¦¬ì†ŒìŠ¤ë“¤ì€ **í´ëŸ¬ìŠ¤í„° ì „ì²´ ë²”ìœ„(cluster-scoped)** ë¦¬ì†ŒìŠ¤ë¡œ, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ ì—°ê²°ë˜ì§€ ì•ŠìŒ
-  ì´ëŸ° ë¦¬ì†ŒìŠ¤ì—” `Role`/`RoleBinding` ëŒ€ì‹  **`ClusterRole`/`ClusterRoleBindingì„ ì‚¬ìš©í•¨`**

## ğŸ”‘ ClusterRoleì´ë€?

- `Role`ê³¼ êµ¬ì¡°ëŠ” ê°™ì§€ë§Œ **ì ìš© ë²”ìœ„ê°€ í´ëŸ¬ìŠ¤í„° ì „ì²´**
- **cluster-scoped ë¦¬ì†ŒìŠ¤**ì— ê¶Œí•œ ë¶€ì—¬í•  ë•Œ í•„ìˆ˜
- ë˜ëŠ” **namespaced ë¦¬ì†ŒìŠ¤ ì „ì²´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì ‘ê·¼ í—ˆìš©**í•  ë•Œë„ ì‚¬ìš© ê°€ëŠ¥

### ì˜ˆì‹œ: Node ë¦¬ì†ŒìŠ¤ì— ê¶Œí•œ ì£¼ê¸°

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-admin-role
rules:
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["get", "create", "delete"]
```

---

## ğŸ”— ClusterRoleBindingì´ë€?

- íŠ¹ì • ì‚¬ìš©ì(User), ê·¸ë£¹(Group), ì„œë¹„ìŠ¤ ê³„ì •(ServiceAccount)ì—ê²Œ **ClusterRoleì„ ë¶€ì—¬**í•¨
- ì´ ê¶Œí•œì€ **í´ëŸ¬ìŠ¤í„° ì „ì²´ì— ì ìš©ë¨**

### ì˜ˆì‹œ

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-admin-role-binding
subjects:
- kind: User
  name: admin-user
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: cluster-admin-role
  apiGroup: rbac.authorization.k8s.io
```

---

## â— ì¤‘ìš” í¬ì¸íŠ¸

|í•­ëª©|ë‚´ìš©|
|---|---|
|ClusterRole|í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤(Node, PV ë“±) ë˜ëŠ” **ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ê±¸ì³ ìˆëŠ” ë¦¬ì†ŒìŠ¤ ì ‘ê·¼** í—ˆìš© ê°€ëŠ¥|
|ClusterRole + ClusterRoleBinding|í´ëŸ¬ìŠ¤í„° ì „ì²´ì— ê¶Œí•œ ë¶€ì—¬|
|ClusterRole + RoleBinding|íŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ë§Œ ì œí•œì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥|

---

## ğŸ§  ì‹¤ì „ ì •ë¦¬

|ë¦¬ì†ŒìŠ¤ ì¢…ë¥˜|ì‚¬ìš©í•˜ëŠ” ê°ì²´|ê¶Œí•œ ë²”ìœ„|
|---|---|---|
|ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¦¬ì†ŒìŠ¤ (Pods, Deployments ë“±)|Role + RoleBinding|íŠ¹ì • ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì•ˆì—ì„œë§Œ|
|í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ (Nodes, PV ë“±)|ClusterRole + ClusterRoleBinding|í´ëŸ¬ìŠ¤í„° ì „ì²´|
|ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¦¬ì†ŒìŠ¤ ì „ì²´ ì ‘ê·¼|ClusterRole + ClusterRoleBinding|**ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ì ìš©ë¨**|

---

## ğŸ“Œ ì¶”ê°€ ì •ë³´

- KubernetesëŠ” í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•  ë•Œ **ê¸°ë³¸ ClusterRole ì—¬ëŸ¬ ê°œ**ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ ë‘   
    â†’ ì˜ˆ: `cluster-admin`, `view`, `edit` ë“±

- `kubectl get clusterrole`ë¡œ í™•ì¸ ê°€ëŠ¥

---

## ğŸ§ª ì˜ˆì‹œ ìƒí™© ë¹„êµ

|ìƒí™©|ê¶Œì¥ ë°©ì‹|
|---|---|
|`dev-user`ê°€ default ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ Podë§Œ ë³´ê²Œ í•˜ê³  ì‹¶ë‹¤|`Role` + `RoleBinding`|
|`admin-user`ê°€ ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ Podì„ ë³´ê²Œ í•˜ê³  ì‹¶ë‹¤|`ClusterRole` + `ClusterRoleBinding`|
|`storage-admin`ì´ PersistentVolumeì„ ë§Œë“¤ê²Œ í•˜ê³  ì‹¶ë‹¤|`ClusterRole` + `ClusterRoleBinding`|
