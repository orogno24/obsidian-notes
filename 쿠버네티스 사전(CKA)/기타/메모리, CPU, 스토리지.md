## 1. 기본 리소스 개념과 비유

### CPU
![[화면 캡처 2025-05-15 111515.png]]
- **실제 개념**: 계산 처리 능력, 작업 처리 시간
- **마인크래프트 비유**: 농장에서 일하는 플레이어
- **특징**: 시간 공유 방식으로 여러 파드 간에 빠르게 전환하며 작업
- **일반 상황 (평화로운 날)**:
	- 대부분 농장이 한가함 (평균 33% CPU 사용)
	- 8명의 플레이어로 24개 농장을 쉽게 관리
- **피크 상황 (축제일)**:
	- 여러 농장이 동시에 바빠짐 (70-80% CPU 사용)
	- 플레이어들이 계속 농장 사이를 빠르게 이동
### 메모리(RAM)
![[화면 캡처 2025-05-15 111138.png]]
- **실제 개념**: 임시 데이터 저장 공간
- **마인크래프트 비유**: 마을 중앙에 있는 하나의 대형 공용 창고
- **특징**: 공간 점유 방식으로 할당되며, 파드 재시작 시 초기화됨
### 스토리지(영구 저장소)

- **실제 개념**: 영구적인 데이터 저장 공간
- **마인크래프트 비유**: 별도의 창고 건물과 상자들
- **특징**: 파드가 재시작되어도 데이터가 유지됨
- **스왑(Swap)이라는 중간 개념**:
	- 메모리가 부족할 때 디스크 공간을 임시 메모리처럼 사용하는 기술
	- 쿠버네티스에서는 일반적으로 스왑을 비활성화하여 사용함 (성능 예측성 때문)
## 2. 노드와 파드의 관계

### 노드(Node)

- **실제 개념**: 물리적/가상 서버 (예: n2-standard-8: 8 vCPU, 32GB RAM)
- **마인크래프트 비유**: 마인크래프트 월드
- **특징**: 제한된 리소스(플레이어 수, 인벤토리 공간)를 여러 파드가 공유
### 파드(Pod)

- **실제 개념**: 컨테이너 그룹, 애플리케이션의 실행 단위
- **마인크래프트 비유**: 농장
- **특징**: 노드의 리소스(플레이어 시간, 인벤토리 공간)를 사용
## 3. CPU 관리 메커니즘

### CPU 요청(Request)

- **정의**: 파드가 보장받는 최소 CPU 처리 능력
- **마인크래프트 비유**: "이 농장은 플레이어 작업 시간의 일정 비율을 보장받음"
- **실제 작동 방식**:
    - CPU 2 요청 = 8코어 노드에서 25%의 CPU 시간 보장
    - 스케줄러가 초고속으로 파드 간 전환하며 요청 비율대로 CPU 시간 분배
	    - - 항상 2명이 여기에 있음 ❌
	    - 8명이 돌아가면서 시간의 25%를 이 농장에 씀 ✅
	    - 결과적으로는 "2명이 계속 있는 것과 같은 효과"
    - 파드가 필요할 때 언제든지 요청한 만큼의 CPU 시간을 사용할 권리 보장
### CPU 제한(Limit)

- **정의**: 파드가 사용할 수 있는 최대 CPU 처리 능력
- **마인크래프트 비유**: "이 농장은 최대 이만큼의 플레이어 작업 시간까지만 사용 가능"
- **실제 작동 방식**:
    - CPU 4 제한 = 최대 노드 CPU의 50%까지만 사용 가능
    - 제한 초과 시 스로틀링(작업 속도 제한)됨
    - 파드가 종료되지는 않음
## 4. 메모리 관리 메커니즘

### 메모리 요청(Request)

- **정의**: 파드가 보장받는 최소 메모리 공간
- **마인크래프트 비유**: "이 농장을 위해 이만큼의 인벤토리 공간을 확보해 둠"
- **실제 작동 방식**:
    - 메모리 4GB 요청 = 4GB의 메모리 공간이 파드에 전용으로 할당
    - 다른 파드는 이 공간을 사용할 수 없음
### 메모리 제한(Limit)

- **정의**: 파드가 사용할 수 있는 최대 메모리 공간
- **마인크래프트 비유**: "이 농장은 최대 이만큼의 인벤토리 공간까지만 사용 가능"
- **실제 작동 방식**:
    - 메모리 8GB 제한 = 8GB 이상 사용 시 파드 강제 종료(OOM Kill)
    - CPU와 달리 초과 시 종료됨 (스로틀링 불가)
## 5. 리소스 설정 유형과 QoS

### 요청/제한 모두 미설정

- **마인크래프트 비유**: 표지판이 없는 무법 농장
- **특징**: 스케줄링 보장 없음, 리소스 부족 시 가장 먼저 종료
- **QoS 클래스**: BestEffort (최하위 우선순위)
### 제한만 설정

- **마인크래프트 비유**: 최대 인원만 표시된 농장
- **특징**: 스케줄링 보장 없음, 리소스 사용량에 상한선만 존재
- **QoS 클래스**: BestEffort (최하위 우선순위)
### 요청/제한 모두 설정

- **마인크래프트 비유**: 완전한 계약이 있는 농장
- **특징**: 스케줄링 보장 있음, 리소스 사용량에 하한선과 상한선 존재
- **QoS 클래스**: Burstable 또는 Guaranteed (requests = limits일 때)
### 요청만 설정

- **마인크래프트 비유**: 최소 인원만 보장된 농장
- **특징**: 스케줄링 보장 있음, 상한선 없이 필요한 만큼 사용 가능
- **QoS 클래스**: Burstable (중간 우선순위)
## 6. 실제 리소스 활용 사례

### 오버커밋(Overcommit)

- **의미**: 노드의 물리적 리소스보다 더 많은 리소스를 요청하는 파드 배치
- **마인크래프트 비유**:
	- **물리적 자원**: 8명의 실제 플레이어(8 CPU 코어)
	- **약속한 자원**: 총 24 CPU 코어 (12개 파드가 각각 CPU 2 요청)
	- **오버커밋 비율**: 3:1 (물리적 CPU의 3배를 약속)
	- **효율적인 이유**: 대부분의 농장은 평소에 한가함 (약 10-20% CPU 사용)
- **실제 작동 원리**:
    - 대부분의 파드는 요청한 리소스를 100% 사용하지 않음
    - CPU는 시간 공유 방식으로 효율적인 오버커밋 가능
    - 메모리는 오버커밋 위험이 높음 (실제 사용 공간 회수 어려움)
### 리소스 사용률 증가 상황

- **CPU 사용률 증가**: 트래픽 급증, CPU 집약적 작업, 제한 없는 파드의 과도한 사용
- **메모리 사용률 증가**: 메모리 누수, 캐싱 증가, 동시 사용자 증가

### 파드 리소스 스펙 예시

```yaml
resources:
  requests:
    memory: "4Gi"
    cpu: 2
  limits:
    memory: "8Gi"
    cpu: 4
```

- **의미**: 최소 2 CPU와 4GB 메모리 보장, 최대 4 CPU와 8GB 메모리 사용 가능
- **마인크래프트 비유**: 항상 2명의 플레이어 작업 시간과 4개의 창고 공간 보장, 필요시 최대 4명의 플레이어 시간과 8개의 창고까지 사용 가능

## 7. 핵심 개념 정리

1. **CPU 요청은 독점이 아닌 시간 공유**:
    - CPU 요청은 "항상 사용"하는 것이 아니라 "필요할 때 사용할 수 있도록 예약"하는 것
    - 초고속 스케줄링으로 플레이어(CPU)는 여러 농장(파드) 사이를 빠르게 이동하며 작업
2. **효율적인 리소스 관리**:
    - 적절한 요청/제한 설정이 안정적이고 효율적인 클러스터 운영의 핵심
    - 대부분의 파드는 간헐적으로 리소스를 사용하므로 적절한 오버커밋이 효율적
3. **QoS 클래스와 우선순위**:
    - Guaranteed (requests = limits): 가장 높은 우선순위
    - Burstable (requests < limits): 중간 우선순위
    - BestEffort (requests와 limits 미설정): 가장 낮은 우선순위
4. **실제 운영 환경에서는**:
	- CPU: 2:1에서 4:1 정도의 오버커밋 비율 흔함
    - 메모리: 1.2:1 정도의 낮은 오버커밋 비율 권장