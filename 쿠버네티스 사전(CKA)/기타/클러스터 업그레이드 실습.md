## 📋 단계별 명령어 정리

### 1️⃣ 현재 상태 확인

```bash
# kubeadm 현재 버전 확인
kubeadm version

# 업그레이드 가능한 kubeadm 버전 확인
sudo apt-cache madison kubeadm
```

### 2️⃣ 저장소 설정 (필요시)

```bash
# 저장소 설정 파일 수정
sudo vi /etc/apt/sources.list.d/kubernetes.list

# 패키지 목록 업데이트
sudo apt update

# 업그레이드 가능한 버전 재확인
sudo apt-cache madison kubeadm
```

### 3️⃣ kubeadm 업그레이드

```bash
# kubeadm 업그레이드
sudo apt-mark unhold kubeadm && \
sudo apt-get update && \
sudo apt-get install -y kubeadm=1.32.0-1.1 && \
sudo apt-mark hold kubeadm

# 업그레이드 확인
kubeadm version
```

### 4️⃣ 업그레이드 계획 확인

```bash
# 쿠버네티스 업그레이드 계획 조회
sudo kubeadm upgrade plan
```

### 5️⃣ 노드 드레인 (파드 대피)

```bash
# 노드에서 파드들을 안전하게 다른 곳으로 이동
kubectl drain controlplane --ignore-daemonsets
```

### 6️⃣ 쿠버네티스 클러스터 업그레이드

```bash
# 실제 클러스터 업그레이드 실행
sudo kubeadm upgrade apply v1.32.0
```

### 7️⃣ kubelet과 kubectl 업그레이드

```bash
# kubelet과 kubectl 업그레이드
sudo apt-mark unhold kubelet kubectl && \
sudo apt-get update && \
sudo apt-get install -y kubelet=1.32.0-1.1 kubectl=1.32.0-1.1 && \
sudo apt-mark hold kubelet kubectl
```

### 8️⃣ kubelet 서비스 재시작

```bash
# 시스템 데몬 리로드
sudo systemctl daemon-reload

# kubelet 서비스 재시작
sudo systemctl restart kubelet
```

### 9️⃣ 노드 복구 (파드 재할당 허용)

```bash
# 노드를 다시 스케줄링 가능한 상태로 변경
kubectl uncordon controlplane
```

## 주요 구성요소 이해하기

### 📦 APT (Advanced Package Tool)

- **역할**: Ubuntu/Debian의 패키지 관리자
- **기능**: 소프트웨어 설치, 업데이트, 제거
- **예시**: `apt install`, `apt update`, `apt upgrade`

### 🔧 kubeadm

- **역할**: 쿠버네티스 클러스터 생성 및 관리 도구
- **기능**: 클러스터 초기화, 노드 추가, 업그레이드
- **예시**: `kubeadm init`, `kubeadm join`, `kubeadm upgrade`

### 🎛️ kubectl

- **역할**: 쿠버네티스 클러스터 제어 도구 (클라이언트)
- **기능**: 파드 생성, 서비스 관리, 리소스 조회
- **예시**: `kubectl get pods`, `kubectl apply`, `kubectl delete`

### 🤖 kubelet

- **역할**: 각 노드에서 실행되는 쿠버네티스 에이전트
- **기능**: 컨테이너 실행, 노드 상태 보고, API 서버와 통신
- **특징**: 백그라운드 서비스로 실행