### ì²« ì‹œì‘

```bash
alias k=kubectl
complete -F __start_kubectl k
```

```bash
# vi ~/.vimrc ì— ì•„ë˜ ë‚´ìš© ì¶”ê°€ (íƒ­ 2ì¹¸ ì„¤ì •)
set tabstop=2
set shiftwidth=2
set expandtab
```

---

## ğŸš€ ì‹œí—˜ì— ìì£¼ ì“°ì´ëŠ” ëª…ë ¹ì–´ ì •ë¦¬

### âœ… íŒŒë“œ ë¼ë²¨ í™•ì¸(--show-labels)

```bash
kubectl get pod <íŒŒë“œëª…> --show-labels
# ë¼ë²¨ ì •ë³´ ì¶œë ¥
```

### âœ… ê°œìˆ˜ ì„¸ê¸°(--no-headers | wc -l)

```bash
kubectl get <ë¦¬ì†ŒìŠ¤> --no-headers | wc -l
# ì¶œë ¥ëœ ë¦¬ì†ŒìŠ¤ ìˆ˜ ì¹´ìš´íŠ¸ (ì˜ˆ: pod ìˆ˜)
```

### âœ… ì„ì‹œ ë””ë²„ê¹…ìš© íŒŒë“œ ìƒì„±

```bash
kubectl run tmp --image=busybox --restart=Never --command -- sleep 1000
# 1000ì´ˆ ë™ì•ˆ ì‹¤í–‰ë˜ëŠ” pod ìƒì„± (ìë™ ì¬ì‹œì‘ ì—†ìŒ)
```

### âœ… ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë³€ê²½(set-context --current --namespace=)

```bash
kubectl config set-context --current --namespace=<ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëª…>
# ê¸°ë³¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„¤ì •
```

### âœ…íŒ¨í‚¤ì§€ ì„¤ì¹˜(dpkg -i)

```bash
dpkg -i <í•´ë‹¹ íŒ¨í‚¤ì§€ ê²½ë¡œ>
```

### âœ…Kubeconfig ë¬¸ì œì  ì°¾ê¸°(kubectl config view)

```bash
# í˜„ì¬ ì‹¤í–‰í•˜ê³  ìˆëŠ” config íŒŒì¼
kubectl config view

# config íŒŒì¼ ì¡°íšŒ
kubectl config view --kubeconfig=/root/CKA/admin.kubeconfig

# ì‚¬ìš©í•  config íŒŒì¼ì„ ë‹¤ë¥¸ê±¸ë¡œ ì§€ì •í•´ì„œ ë¬¸ì œ ì°¾ê¸°
kubectl get pods --kubeconfig=/root/CKA/admin.kubeconfig
```

### âœ…ì„œë¹„ìŠ¤ì˜ ì—”ë“œí¬ì¸íŠ¸ ê²€ìƒ‰(get endpoints)

```bash
kubectl get endpoints <ì„œë¹„ìŠ¤-ì´ë¦„>
```

### âœ… ì •ë ¬í•´ì„œ ë³´ê¸° (`--sort-by`)

```bash
kubectl get pods --sort-by=.spec.nodeName # ë…¸ë“œ ì´ë¦„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ 
kubectl get pods --sort-by=.status.containerStatuses[0].restartCount
# ì¬ì‹œì‘ íšŸìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ 
kubectl get nodes --sort-by=.metadata.name # ë…¸ë“œ ì´ë¦„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
```

### âœ… ì´ë¯¸ì§€ ë³€ê²½ (`set image --record`)


``` bash
kubectl set image deployment/<ë””í”Œë¡œì´ë¨¼íŠ¸ëª…> <ì»¨í…Œì´ë„ˆëª…>=<ì´ë¯¸ì§€>:<íƒœê·¸> --record
# ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ ë° ë³€ê²½ ì´ë ¥ ê¸°ë¡
```

### âœ… ë””í”Œë¡œì´ë¨¼íŠ¸ ë¡¤ì•„ì›ƒ ê´€ë¦¬ (`rollout`)

``` bash
kubectl rollout history deployment/<ì´ë¦„> # ë³€ê²½ ì´ë ¥ ë³´ê¸°
kubectl rollout status deployment/<ì´ë¦„> # ë°°í¬ ìƒíƒœ í™•ì¸
kubectl rollout undo deployment/<ì´ë¦„> # ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
kubectl rollout restart deployment/<ì´ë¦„> # ë””í”Œë¡œì´ë¨¼íŠ¸ ì¬ì‹œì‘ (íŒŒë“œ ì¬ìƒì„±)
```

> ğŸ’¡ `--record` ì˜µì…˜ê³¼ í•¨ê»˜ `set image` ì‚¬ìš© ì‹œ, historyì—ì„œ ë³€ê²½ ì´ë ¥ í™•ì¸ ê°€ëŠ¥

### âœ… ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸(metrics-server ì„¤ì¹˜, kubectl top)

```bash
# metrics-server ê³µì‹ YAMLì„ ì‚¬ìš©
kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

# self-signed certificatesë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
# kubectl edit deployment metrics-server -n kube-systemì—ì„œ ìˆ˜ì • í•„ìš” 
spec:
  template:
    spec:
      containers:
      - name: metrics-server
        args:
        - --kubelet-insecure-tls

# ê¸°ë³¸ Pod ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl top pods

# ë…¸ë“œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl top nodes

# CPU ì‚¬ìš©ëŸ‰ ìˆœìœ¼ë¡œ ì •ë ¬
kubectl top pods --sort-by=cpu

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìˆœìœ¼ë¡œ ì •ë ¬
kubectl top pods --sort-by=memory
```

### âœ… ì •ë ¬í•´ì„œ ë³´ê¸° (`--sort-by`)

```bash
kubectl get pods --sort-by=.spec.nodeName # ë…¸ë“œ ì´ë¦„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ 
kubectl get pods --sort-by=.status.containerStatuses[0].restartCount
# ì¬ì‹œì‘ íšŸìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ 
kubectl get nodes --sort-by=.metadata.name # ë…¸ë“œ ì´ë¦„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
```

#### kustomize

```
my-kustomize/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ kustomization.yaml
â””â”€â”€ overlays/
    â””â”€â”€ prod/
        â”œâ”€â”€ kustomization.yaml
        â””â”€â”€ deployment-patch.yaml

---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base

namespace: prod

namePrefix: prod-

commonLabels: # ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ë¼ë²¨ ì¶”ê°€
  env: prod

patchesStrategicMerge:
  - deployment-patch.yaml
  
---
```

```
# ë¦¬ì†ŒìŠ¤ ìƒì„±
kubectl apply -k overlays/prod

# ì ìš©í•˜ì§€ ì•Šê³  ëˆˆìœ¼ë¡œë§Œ ê²°ê³¼ í™•ì¸
kubectl kustomize overlays/prod

# yaml íŒŒì¼ë¡œ ì €ì¥ (ì œì¶œìš©)
kubectl kustomize overlays/prod > /root/final.yaml
```
