eris/sts-svc

FROM nexus-nexus-repository-manager:9900/tomcat:9.0-jdk8

# OpenJDK 17 설치
COPY ./openjdk-17.0.2_linux-x64_bin.tar.gz /tmp/

RUN mkdir -p /usr/lib/jvm && \
    cd /tmp && \
    tar -xf openjdk-17.0.2_linux-x64_bin.tar.gz -C /usr/lib/jvm && \
    rm openjdk-17.0.2_linux-x64_bin.tar.gz
ENV JAVA_HOME=/usr/lib/jvm/jdk-17.0.2
ENV PATH=$JAVA_HOME/bin:$PATH

# PostgreSQL JDBC 드라이버 복사
COPY ./postgresql-42.7.6.jar /usr/local/tomcat/lib/

# DataServer 애플리케이션 복사
RUN mkdir -p /data
COPY ./DataServer /data/DataServer
COPY ./ReportingServer /data/ReportingServer

# 포트 노출
EXPOSE 8080

# Tomcat 실행
CMD ["catalina.sh", "run"]

deployment.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: eris-be-sts
  name: eris-be-sts
  namespace: eris-be
spec:
  replicas: 1
  selector:
    matchLabels:
      app: eris-be-sts
  template:
    metadata:
      labels:
        app: eris-be-sts
    spec:
      containers:
      - name: eris-be-sts
        image: cicd.harbor.dev.eris.go.kr/eris/sts-svc:1.0.3
        ports:
          - containerPort: 8080
        volumeMounts:
          - name: webapps
            mountPath: /usr/local/tomcat/webapps
      initContainers:
      - name: eris-be-sts-copy
        image: cicd.harbor.dev.eris.go.kr/eris/sts-svc:1.0.3
        volumeMounts:
          - name: webapps
            mountPath: /usr/local/tomcat/webapps
        command:
          - sh
          - -c          
          - 'cp -r /data/* /usr/local/tomcat/webapps/'
      volumes:
        - name: webapps
          persistentVolumeClaim:
            claimName: eris-be-sts-pvc


통계서비스 레포지토리와 파이프라인 사용해서 파일 수정할 수있도록 수정  
통계서비스만 파일과 파이프라인이 다름  
crownix.groovy와 rollback-cronwix.groovy 사용  
pvc, ingress 사용