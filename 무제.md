apiVersion: apps/v1
kind: Deployment
metadata:
  name: eris-be-mnt
  namespace: eris-be
  labels:
    app: eris-be-mnt
spec:
  replicas: 2
  selector:
    matchLabels:
      app: eris-be-mnt
  template:
    metadata:
      labels:
        app: eris-be-mnt
    spec:
      imagePullSecrets:
        - name: harbor-secret
      initContainers:
        - name: init-create-folders
          image: busybox
          command: ["/bin/sh", "-c"]
          args:
            - mkdir -p /data/origin /data/thumb
          volumeMounts:
            - name: files-volume
              mountPath: /data
      containers:
        - name: eris-be-mnt
          image: cicd.harbor.dev.eris.go.kr/eris/mnt-svc:null
          imagePullPolicy: Always
          env:
            - name: JAEGER_AGENT_HOST
              value: "localhost"
            - name: JAEGER_AGENT_PORT
              value: "6831"
          ports:
            - containerPort: 8080
          volumeMounts:
            - name: files-volume
              mountPath: /jrps_msg/files
        - name: jaeger-agent
          image: jaegertracing/jaeger-agent:latest
          args:
            - "--reporter.grpc.host-port=jaeger-prod-collector.observability:14250"
            - "--reporter.type=grpc"
          ports:
            - containerPort: 5775
              protocol: UDP
            - containerPort: 6831
              protocol: UDP
            - containerPort: 6832
              protocol: UDP
            - containerPort: 5778
              protocol: TCP
      volumes:
        - name: files-volume
          persistentVolumeClaim:
            claimName: eris-be-mnt-files-pvc
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: eris-be-mnt-files-pvc
  namespace: eris-be
  labels:
    app: eris-be-mnt
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 500Gi
  storageClassName: okestro-nfs-retain
  volumeMode: Filesystem
  apiVersion: v1
kind: Service
metadata:
  name: eris-be-mnt
spec:
  selector:
    app: eris-be-mnt
  type: ClusterIP
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: eris-be
resources:
  - deployment.yaml
  - service.yaml
  - pvc.yaml