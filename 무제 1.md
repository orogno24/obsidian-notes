## Istio 설치 과정

### 1. Istio CLI 설치

```bash
$ curl -L https://istio.io/downloadIstio | sh -
$ cd istio-1.22.0
$ export PATH=$PWD/bin:$PATH
$ istioctl version
```

### 2. Istio 설치

```bash
$ istioctl install --set profile=demo -y
$ kubectl label namespace default istio-injection=enabled
$ kubectl get pods -n istio-system
$ kubectl get svc -n istio-system
```

## Kiali 설치 과정

### 1. Kiali 설치

```bash
$ kubectl apply -f samples/addons/kiali.yaml
$ kubectl rollout status deployment/kiali -n istio-system
```

### 2. Kiali 대시보드 접속

```bash
$ kubectl port-forward svc/kiali -n istio-system 20001:20001
```

### 3. Helm을 통한 설치 (대안)

```bash
$ helm repo add kiali https://kiali.org/helm-charts
$ helm repo update
$ helm install \
    --namespace istio-system \
    --set auth.strategy="anonymous" \
    kiali-server \
    kiali/kiali-server
```

## Jaeger 설치 과정

### 1. cert-manager 설치

```bash
$ kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.14.0/cert-manager.yaml
$ kubectl wait --for=condition=available --timeout=300s deployment/cert-manager -n cert-manager
$ kubectl wait --for=condition=available --timeout=300s deployment/cert-manager-webhook -n cert-manager
```

### 2. Jaeger Operator 설치

```bash
$ kubectl create namespace observability
$ kubectl apply -f https://github.com/jaegertracing/jaeger-operator/releases/download/v1.57.0/jaeger-operator.yaml -n observability
$ kubectl get deployment jaeger-operator -n observability
```

### 3. Jaeger 인스턴스 생성

```bash
$ cat <<EOF | kubectl apply -f -
apiVersion: jaegertracing.io/v1
kind: Jaeger
metadata:
  name: jaeger-instance
  namespace: istio-system
spec:
  strategy: allInOne
  allInOne:
    image: jaegertracing/all-in-one:latest
    options:
      log-level: debug
  storage:
    type: memory
  ingress:
    enabled: false
EOF
```

### 4. Istio와 Jaeger 연동

```bash
$ cat <<EOF | kubectl apply -f -
apiVersion: v1
data:
  mesh: |-
    defaultConfig:
      proxyStatsMatcher:
        inclusionRegexps:
        - ".*outlier_detection.*"
        - ".*circuit_breakers.*"
        - ".*upstream_rq_retry.*"
        - ".*upstream_rq_pending.*"
        - ".*_cx_.*"
    extensionProviders:
    - name: jaeger
      envoyOtelAls:
        service: jaeger-instance-collector.istio-system.svc.cluster.local
        port: 4317
    defaultProviders:
      tracing:
      - jaeger
kind: ConfigMap
metadata:
  name: istio
  namespace: istio-system
EOF
```

### 5. 샘플링 비율 설정

```bash
$ cat <<EOF | kubectl apply -f -
apiVersion: telemetry.istio.io/v1alpha1
kind: Telemetry
metadata:
  name: default-tracing
  namespace: istio-system
spec:
  tracing:
  - providers:
    - name: jaeger
    randomSamplingPercentage: 1.0
EOF
```

### 6. Jaeger UI 접속

```bash
$ kubectl port-forward svc/jaeger-instance-query -n istio-system 16686:16686
```

### 7. 설치 확인

```bash
$ kubectl get pods -n istio-system | grep jaeger
$ kubectl get pods -n istio-system | grep kiali
$ kubectl get jaeger -n istio-system
```

### 8. 샘플 애플리케이션 배포 (선택사항)

```bash
$ kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml
$ kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml
$ kubectl get pods
$ kubectl get svc
```