### ë…ë¦½ë§(Air-gapped) í™˜ê²½ì´ë€?

- **ì •ì˜**: ì¸í„°ë„·ì´ ì™„ì „íˆ ì°¨ë‹¨ëœ ë„¤íŠ¸ì›Œí¬ í™˜ê²½
- **ëª©ì **: ë³´ì•ˆì„± ê·¹ëŒ€í™”, ì™¸ë¶€ ì¹¨ì… ì›ì²œ ì°¨ë‹¨
- **íŠ¹ì§•**: ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ëŠ” ìœ ì§€, ì™¸ë¶€ ì¸í„°ë„·ë§Œ ì°¨ë‹¨

### Nexus Repositoryì˜ ì—­í• 

```mermaid
graph LR
    A[ê°œë°œì] --> B[ë¡œì»¬ ë„¤íŠ¸ì›Œí¬]
    B --> C[Nexus Repository]
    C --> D[Docker Images]
    C --> E[Maven/Gradle]
    C --> F[NPM Packages]
    C --> G[Helm Charts]
    
    H[ì¸í„°ë„·] -.-> I[ì°¨ë‹¨ë¨]
    
    style C fill:#74b9ff,stroke:#0984e3,color:#fff
    style I fill:#e74c3c,stroke:#d63031,color:#fff
```

> [!important] í•µì‹¬ ì•„ì´ë””ì–´ Nexus = ë…ë¦½ë§ í™˜ê²½ì˜ "ì¢…í•© íŒ¨í‚¤ì§€ ì°½ê³ " ê°œë°œì— í•„ìš”í•œ ëª¨ë“  ê²ƒì„ ë¯¸ë¦¬ ì €ì¥í•´ë‘ì–´ ì¸í„°ë„· ì—†ì´ë„ ì™„ì „í•œ ê°œë°œ í™˜ê²½ êµ¬ì¶• ê°€ëŠ¥

## ğŸ³ ë…ë¦½ë§ì—ì„œ ì´ë¯¸ì§€ Pull ì„¤ì •

### ì„œë¹„ìŠ¤ í¬íŠ¸ í™•ì¸

```bash
kubectl get svc -n cicd nexus-nexus-repository-manager
# ê²°ê³¼: 
# 8081:30081/TCP  <- Nexus UI
# 9900:32415/TCP  <- Docker Registry
```

### Docker ì„¤ì • (ëª¨ë“  ë…¸ë“œ)

```bash
# /etc/docker/daemon.json
{
  "insecure-registries": ["<node-ip>:32415", "localhost:32415"]
}

sudo systemctl restart docker
```

### ì´ë¯¸ì§€ ì‚¬ìš©

```bash
# Docker ë¡œê·¸ì¸
docker login <node-ip>:32415
Username: admin
Password: <admin-password>

# ì´ë¯¸ì§€ Pull (êµ¬ì¡°: <registry>/<path>:<tag>)
docker pull <node-ip>:32415/my-docker-image/jaeger-agent:1.62.0

# Kubernetesì—ì„œ ì‚¬ìš©
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      containers:
      - name: jaeger-agent
        image: <node-ip>:32415/my-docker-image/jaeger-agent:1.62.0
        imagePullPolicy: IfNotPresent  # ì¤‘ìš”: ë¡œì»¬ ìš°ì„ 
```

---

## ğŸŒ ë„¤íŠ¸ì›Œí¬ ì›ë¦¬ ì´í•´

### ëœì„ ì„ ë½‘ì•„ë„ Nexusê°€ ì‘ë™í•˜ëŠ” ì´ìœ 

```
[ë‹¹ì‹  ì»´í“¨í„°] â†â†’ [ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ 10.100.0.x] â†â†’ [ë¼ìš°í„°] â†â†’ [ì¸í„°ë„·]
     âœ…                    âœ…                    âŒ        âŒ
   (ì‘ë™í•¨)              (ì‘ë™í•¨)            (ì°¨ë‹¨ë¨)   (ì°¨ë‹¨ë¨)
```

#### ì§‘ì—ì„œ ë¹„ìœ 

- **ëœì„  ë½‘ê¸°** = ì§‘ ëŒ€ë¬¸ì„ ì ê·¸ëŠ” ê²ƒ
- **ê°™ì€ ì§‘ ì•ˆ ë°©ë“¤** = ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ (10.100.0.x)
- **ì´ì›ƒì§‘ ë°©ë¬¸** = ì¸í„°ë„· ì ‘ì†

> [!note] í•µì‹¬ ì´í•´ ëœì„ ì„ ë½‘ì•„ë„ ê°™ì€ ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ ë‚´ì—ì„œëŠ” í†µì‹ ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. Nexus ì„œë²„(10.100.0.102)ê°€ ê°™ì€ ë„¤íŠ¸ì›Œí¬ì— ìˆì–´ì„œ ì ‘ì†í•  ìˆ˜ ìˆëŠ” ê²ƒ!

### ì¼ë°˜ í™˜ê²½ vs ë…ë¦½ë§ í™˜ê²½

|êµ¬ë¶„|ì¼ë°˜ ë„¤íŠ¸ì›Œí¬ í™˜ê²½|ë…ë¦½ë§ í™˜ê²½|
|---|---|---|
|**ì˜ì¡´ì„± ì†ŒìŠ¤**|ì¸í„°ë„· ì‹¤ì‹œê°„ ë‹¤ìš´ë¡œë“œ|Nexus ë¡œì»¬ ì €ì¥ì†Œ|
|**ë¹Œë“œ ì‹œê°„**|ì²« ë²ˆì§¸: ëŠë¦¼, ì´í›„: ë¹ ë¦„|í•­ìƒ ë¹ ë¦„|
|**ë³´ì•ˆì„±**|ë‚®ìŒ (ì™¸ë¶€ ì˜ì¡´ì„±)|ë†’ìŒ (ë‚´ë¶€ ì œì–´)|
|**ì•ˆì •ì„±**|ì¸í„°ë„· ì˜ì¡´ì |ì¸í„°ë„· ë…ë¦½ì |
|**ì„¤ì • ë³µì¡ë„**|ê°„ë‹¨|ë³µì¡ (ì‚¬ì „ ì¤€ë¹„)|

---

## ğŸ“¦ ì˜ì¡´ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬

### ë…ë¦½ë§ì—ì„œ ì˜ì¡´ì„±ì´ ì—†ì„ ë•Œì˜ ì°¸ì‚¬

#### ì—°ì‡„ ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤

```bash
# 1. ë¹Œë“œ ì‹œë„
./gradlew build

# 2. ì‹¤íŒ¨ ë©”ì‹œì§€
> Could not resolve org.springframework.boot:spring-boot-starter-web:3.2.0
> Could not GET 'https://repo.maven.apache.org/maven2/...'
> Connection timeout: no route to host
BUILD FAILED

# 3. Docker ì´ë¯¸ì§€ ë¹Œë“œ ì‹¤íŒ¨
# 4. Kubernetes ë°°í¬ ì‹¤íŒ¨
```

> [!danger] ì¤‘ìš”í•œ í˜„ì‹¤ **í•˜ë‚˜ì˜ ì˜ì¡´ì„±ì´ë¼ë„ ì—†ìœ¼ë©´ ì „ì²´ ë¹Œë“œê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤!** Spring Boot í”„ë¡œì íŠ¸ í•˜ë‚˜ë§Œ í•´ë„ 200ê°œê°€ ë„˜ëŠ” jar íŒŒì¼ì´ í•„ìš”í•´ìš”.

### ê° ì–¸ì–´ë³„ Nexus ì„¤ì •

#### Java (Gradle)

```gradle
// build.gradle
repositories {
    maven {
        url "http://10.100.0.102:8081/repository/maven-public/"
        allowInsecureProtocol = true
    }
}
```

#### Node.js (NPM)

```bash
# .npmrc
registry=http://10.100.0.102:8081/repository/npm-group/
strict-ssl=false
```

#### Python (PyPI)

```bash
# pip.conf
[global]
index-url = http://10.100.0.102:8081/repository/pypi-group/simple/
trusted-host = 10.100.0.102
```

---

## â›µ Helm Chartì™€ Operator ì„¤ì¹˜

### Helm Chartê°€ Nexusì— ì €ì¥ë˜ëŠ” ì´ìœ 

> [!info] Helm Chart = ì¿ ë²„ë„¤í‹°ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ "ì„¤ì¹˜ íŒ¨í‚¤ì§€" Windowsì˜ .exe íŒŒì¼ì´ë‚˜ ì•ˆë“œë¡œì´ë“œì˜ .apk íŒŒì¼ì²˜ëŸ¼, Kubernetesì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” íŒ¨í‚¤ì§€

### ë…ë¦½ë§ì—ì„œ Helm ì„¤ì¹˜ ê³¼ì •

#### 1. Repository ë“±ë¡

```bash
# ì¼ë°˜ í™˜ê²½
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts

# ë…ë¦½ë§ í™˜ê²½  
helm repo add nexus-charts http://10.100.0.102:8081/repository/helm-charts/
helm repo update
```

#### 2. values.yaml ìˆ˜ì •

```yaml
# prometheus-values.yaml
server:
  image:
    repository: 10.100.0.102:32415/prom/prometheus  # Nexus ë ˆì§€ìŠ¤íŠ¸ë¦¬
    tag: v2.45.0
    pullPolicy: IfNotPresent
  
alertmanager:
  image:
    repository: 10.100.0.102:32415/prom/alertmanager
    tag: v0.25.0
    pullPolicy: IfNotPresent
```

#### 3. ì„¤ì¹˜ ì‹¤í–‰

```bash
# ë…ë¦½ë§ì—ì„œ Prometheus ì„¤ì¹˜ (í•œ ì¤„ë¡œ!)
helm install prometheus nexus-charts/prometheus -f prometheus-values.yaml
```

### Operator ë…ë¦½ë§ ì„¤ì¹˜

#### ì¤€ë¹„ë¬¼

- Operator ë³¸ì²´ ì´ë¯¸ì§€
- ê´€ë¦¬í•  ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¯¸ì§€ë“¤
- CRD ë° RBAC YAML íŒŒì¼ë“¤
- Webhook/Admission Controller ì´ë¯¸ì§€ë“¤

#### ì„¤ì¹˜ ê³¼ì •

```bash
# Operator ì„¤ì¹˜ (ì¼ë°˜ í™˜ê²½ê³¼ ë™ì¼!)
helm install prometheus-operator nexus-charts/kube-prometheus-stack \
  -f prometheus-operator-nexus-values.yaml

# í™•ì¸
kubectl get pods -n monitoring
```

> [!success] ê²°ë¡  **ë…ë¦½ë§ì—ì„œë„ í•œ ì¤„ë¡œ ì„¤ì¹˜ ê°€ëŠ¥í•©ë‹ˆë‹¤!** ì‚¬ì „ ì¤€ë¹„ë§Œ ì™„ë£Œë˜ë©´ ì¼ë°˜ í™˜ê²½ê³¼ 100% ë™ì¼í•œ ê²½í—˜ì´ ê°€ëŠ¥í•´ìš”.

---

## ğŸ” ì´ë¯¸ì§€ ì¶”ì¶œ ìë™í™”

### ì´ë¯¸ì§€ ë°œêµ´ ë°©ë²•ë“¤

#### 1. Helm Template ë¶„ì„ (ê°€ì¥ ì •í™•)

```bash
# Helm Chartì˜ ëª¨ë“  ì´ë¯¸ì§€ ì¶”ì¶œ
helm template my-release prometheus-community/prometheus \
  --values values.yaml > rendered.yaml

# ì´ë¯¸ì§€ ì¶”ì¶œ
grep -E "image:|repository:" rendered.yaml | sort -u
```

#### 2. values.yaml ë¶„ì„ (ê°€ì¥ ë¹ ë¦„)

```bash
curl -s https://raw.githubusercontent.com/prometheus-community/helm-charts/main/charts/prometheus/values.yaml \
  | grep -A 5 -B 5 "repository:\|tag:"
```

#### 3. ì‹¤ì œ ì„¤ì¹˜ í›„ ì¶”ì¶œ (100% ì •í™•)

```bash
# í…ŒìŠ¤íŠ¸ í™˜ê²½ì— ì‹¤ì œ ì„¤ì¹˜
helm install test-prometheus prometheus-community/prometheus

# ì‹¤í–‰ ì¤‘ì¸ Podë“¤ì˜ ì´ë¯¸ì§€ ì¶”ì¶œ
kubectl get pods -o jsonpath='{range .items[*]}{.spec.containers[*].image}{"\n"}{end}' | sort -u

# Init Container ì´ë¯¸ì§€ë„ ì¶”ì¶œ
kubectl get pods -o jsonpath='{range .items[*]}{.spec.initContainers[*].image}{"\n"}{end}' | sort -u
```

### ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©ë²•

```bash
# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./extract-images.sh prometheus-community/prometheus
./extract-images.sh grafana/grafana --version 6.58.9

# ê²°ê³¼ íŒŒì¼ë“¤
# - images-prometheus-community-prometheus-25.1.0.txt
# - push-to-nexus.sh (Nexus ì—…ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸)
# - values-nexus-template.yaml (ë…ë¦½ë§ìš© ì„¤ì •)
# - install-in-isolated.sh (ë…ë¦½ë§ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸)
```

---

## ğŸš€ ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€

### ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì™„ì „ ì„¤ì¹˜

#### í•„ìš”í•œ ì´ë¯¸ì§€ë“¤

```bash
# Prometheus Stack
prom/prometheus:v2.45.0
prom/alertmanager:v0.25.0
prom/node-exporter:v1.6.0
kiwigrid/k8s-sidecar:1.25.1

# Grafana
grafana/grafana:10.1.0
busybox:1.35.0
curlimages/curl:8.2.0

# Jaeger
jaegertracing/jaeger-operator:1.49.0
jaegertracing/jaeger-agent:1.65.0
jaegertracing/jaeger-collector:1.65.0
jaegertracing/jaeger-query:1.65.0
```

#### ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# install-monitoring.sh - ë…ë¦½ë§ ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì„¤ì¹˜

# Repository ë“±ë¡
helm repo add nexus-charts http://10.100.0.102:8081/repository/helm-charts/

# Prometheus ì„¤ì¹˜
helm install prometheus nexus-charts/prometheus \
  -f configs/prometheus-nexus.yaml

# Grafana ì„¤ì¹˜  
helm install grafana nexus-charts/grafana \
  -f configs/grafana-nexus.yaml

# Jaeger ì„¤ì¹˜
helm install jaeger nexus-charts/jaeger \
  -f configs/jaeger-nexus.yaml

echo "ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì„¤ì¹˜ ì™„ë£Œ!"
```

---

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œë“¤

#### 1. manifest unknown ì—ëŸ¬

```bash
# ë¬¸ì œ: ì´ë¯¸ì§€ ê²½ë¡œë‚˜ íƒœê·¸ê°€ ì˜ëª»ë¨
# í•´ê²°: ì •í™•í•œ ì´ë¯¸ì§€ ê²½ë¡œ í™•ì¸
docker images | grep <image-name>
```

#### 2. disk space ì—ëŸ¬

```bash
# ë¬¸ì œ: ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±
# í•´ê²°: ì •ë¦¬ ì‘ì—…
docker system prune -a
journalctl --vacuum-time=3d
```

#### 3. memory error

```bash
# ë¬¸ì œ: Nexus JVM í™ ë©”ëª¨ë¦¬ ë¶€ì¡±
# í•´ê²°: values.yamlì—ì„œ ë©”ëª¨ë¦¬ ì¦ê°€
nexus:
  env:
  - name: INSTALL4J_ADD_VM_PARAMS
    value: "-Xms8192M -Xmx8192M"
```

#### 4. permission denied

```bash
# ë¬¸ì œ: íŒŒì¼ ê¶Œí•œ ë¬¸ì œ
# í•´ê²°: ì˜¬ë°”ë¥¸ ê¶Œí•œ ì„¤ì •
chown -R 200:200 /nexus-data/
```

### ì„±ê³µ ìš”ì¸ë“¤

> [!tip] ì„±ê³µì„ ìœ„í•œ í•µì‹¬ ìš”ì†Œë“¤
> 
> - **í¬íŠ¸ êµ¬ë¶„**: Nexus UI(30081)ì™€ Docker Registry(32415) í¬íŠ¸ê°€ ë‹¤ë¦„
> - **ê²½ë¡œ êµ¬ì¡°**: `<registry>/<image-path>:<tag>` í˜•ì‹ ì¤€ìˆ˜
> - **ê¶Œí•œ ì„¤ì •**: ë³µì› ì‹œ 200:200 (nexus ì‚¬ìš©ì) ê¶Œí•œ ì„¤ì • í•„ìˆ˜
> - **insecure-registry**: Docker daemon.jsonì— ë“±ë¡ í•„ìš”
> - **imagePullPolicy**: IfNotPresentë¡œ ì„¤ì •í•˜ì—¬ ë¡œì»¬ ìš°ì„  ì‚¬ìš©

---
## ğŸ¯ ìµœì¢… ê²°ë¡ 

**ë…ë¦½ë§ í™˜ê²½ì—ì„œë„ ì¼ë°˜ ë„¤íŠ¸ì›Œí¬ì™€ ë™ì¼í•œ ê°œë°œ ê²½í—˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!**

í•µì‹¬ì€ **"ì™„ë²½í•œ ì‚¬ì „ ì¤€ë¹„"**:

1. ëª¨ë“  ì´ë¯¸ì§€ë¥¼ Nexusì— ì €ì¥
2. ëª¨ë“  Chartì™€ íŒ¨í‚¤ì§€ë¥¼ Nexusì— ì €ì¥
3. ì„¤ì • íŒŒì¼ì„ Nexus ê²½ë¡œë¡œ ìˆ˜ì •
4. ìë™í™” ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¼ê´€ëœ ì„¤ì¹˜ í”„ë¡œì„¸ìŠ¤ êµ¬ì¶•

ì´ ê³¼ì •ì„ ê±°ì¹˜ë©´ `helm install` í•œ ì¤„ë¡œ ë³µì¡í•œ ì˜¤í”ˆì†ŒìŠ¤ë„ ì‰½ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆì–´ìš”! ğŸ‰